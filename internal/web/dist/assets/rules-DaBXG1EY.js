import{r as a,c as Ce,j as r,u as Pe,a as Ee,R as Re,h as Te,t as se}from"./index-BIA9nVWk.js";import{b as k,c as Ne,P as H,d as $,e as D,f as _,g as Ae,u as F,a as Y,B as J}from"./api-CF1mdzCj.js";import{u as Le}from"./useMutation-BUAWeYRL.js";import{l as le}from"./js-yaml-DOuxXFsS.js";import{T as Z,p as _e}from"./topbar-Fz-IxQaZ.js";import{c as I}from"./utils-CBfrqCZ4.js";import{C as B,a as U,b as V,c as X,d as ee}from"./card-D4NqIVBJ.js";import{B as re}from"./badge-BHqjMmc7.js";import{c as De}from"./index-BdQq_4o_.js";import{T as ze}from"./textarea-B07UdKsX.js";import{S as L}from"./skeleton-BW1KpBBS.js";function Oe(e,n){return a.useReducer((t,o)=>n[t][o]??t,e)}var te="ScrollArea",[ce]=Ne(te),[Me,y]=ce(te),de=a.forwardRef((e,n)=>{const{__scopeScrollArea:t,type:o="hover",dir:s,scrollHideDelay:l=600,...i}=e,[d,u]=a.useState(null),[f,c]=a.useState(null),[p,m]=a.useState(null),[b,S]=a.useState(null),[T,E]=a.useState(null),[v,N]=a.useState(0),[P,j]=a.useState(0),[A,R]=a.useState(!1),[z,O]=a.useState(!1),x=k(n,h=>u(h)),g=Ce(s);return r.jsx(Me,{scope:t,type:o,dir:g,scrollHideDelay:l,scrollArea:d,viewport:f,onViewportChange:c,content:p,onContentChange:m,scrollbarX:b,onScrollbarXChange:S,scrollbarXEnabled:A,onScrollbarXEnabledChange:R,scrollbarY:T,onScrollbarYChange:E,scrollbarYEnabled:z,onScrollbarYEnabledChange:O,onCornerWidthChange:N,onCornerHeightChange:j,children:r.jsx(H.div,{dir:g,...i,ref:x,style:{position:"relative","--radix-scroll-area-corner-width":v+"px","--radix-scroll-area-corner-height":P+"px",...e.style}})})});de.displayName=te;var ue="ScrollAreaViewport",he=a.forwardRef((e,n)=>{const{__scopeScrollArea:t,children:o,nonce:s,...l}=e,i=y(ue,t),d=a.useRef(null),u=k(n,d,i.onViewportChange);return r.jsxs(r.Fragment,{children:[r.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),r.jsx(H.div,{"data-radix-scroll-area-viewport":"",...l,ref:u,style:{overflowX:i.scrollbarXEnabled?"scroll":"hidden",overflowY:i.scrollbarYEnabled?"scroll":"hidden",...e.style},children:r.jsx("div",{ref:i.onContentChange,style:{minWidth:"100%",display:"table"},children:o})})]})});he.displayName=ue;var C="ScrollAreaScrollbar",fe=a.forwardRef((e,n)=>{const{forceMount:t,...o}=e,s=y(C,e.__scopeScrollArea),{onScrollbarXEnabledChange:l,onScrollbarYEnabledChange:i}=s,d=e.orientation==="horizontal";return a.useEffect(()=>(d?l(!0):i(!0),()=>{d?l(!1):i(!1)}),[d,l,i]),s.type==="hover"?r.jsx(ke,{...o,ref:n,forceMount:t}):s.type==="scroll"?r.jsx(He,{...o,ref:n,forceMount:t}):s.type==="auto"?r.jsx(me,{...o,ref:n,forceMount:t}):s.type==="always"?r.jsx(oe,{...o,ref:n}):null});fe.displayName=C;var ke=a.forwardRef((e,n)=>{const{forceMount:t,...o}=e,s=y(C,e.__scopeScrollArea),[l,i]=a.useState(!1);return a.useEffect(()=>{const d=s.scrollArea;let u=0;if(d){const f=()=>{window.clearTimeout(u),i(!0)},c=()=>{u=window.setTimeout(()=>i(!1),s.scrollHideDelay)};return d.addEventListener("pointerenter",f),d.addEventListener("pointerleave",c),()=>{window.clearTimeout(u),d.removeEventListener("pointerenter",f),d.removeEventListener("pointerleave",c)}}},[s.scrollArea,s.scrollHideDelay]),r.jsx($,{present:t||l,children:r.jsx(me,{"data-state":l?"visible":"hidden",...o,ref:n})})}),He=a.forwardRef((e,n)=>{const{forceMount:t,...o}=e,s=y(C,e.__scopeScrollArea),l=e.orientation==="horizontal",i=G(()=>u("SCROLL_END"),100),[d,u]=Oe("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return a.useEffect(()=>{if(d==="idle"){const f=window.setTimeout(()=>u("HIDE"),s.scrollHideDelay);return()=>window.clearTimeout(f)}},[d,s.scrollHideDelay,u]),a.useEffect(()=>{const f=s.viewport,c=l?"scrollLeft":"scrollTop";if(f){let p=f[c];const m=()=>{const b=f[c];p!==b&&(u("SCROLL"),i()),p=b};return f.addEventListener("scroll",m),()=>f.removeEventListener("scroll",m)}},[s.viewport,l,u,i]),r.jsx($,{present:t||d!=="hidden",children:r.jsx(oe,{"data-state":d==="hidden"?"hidden":"visible",...o,ref:n,onPointerEnter:D(e.onPointerEnter,()=>u("POINTER_ENTER")),onPointerLeave:D(e.onPointerLeave,()=>u("POINTER_LEAVE"))})})}),me=a.forwardRef((e,n)=>{const t=y(C,e.__scopeScrollArea),{forceMount:o,...s}=e,[l,i]=a.useState(!1),d=e.orientation==="horizontal",u=G(()=>{if(t.viewport){const f=t.viewport.offsetWidth<t.viewport.scrollWidth,c=t.viewport.offsetHeight<t.viewport.scrollHeight;i(d?f:c)}},10);return M(t.viewport,u),M(t.content,u),r.jsx($,{present:o||l,children:r.jsx(oe,{"data-state":l?"visible":"hidden",...s,ref:n})})}),oe=a.forwardRef((e,n)=>{const{orientation:t="vertical",...o}=e,s=y(C,e.__scopeScrollArea),l=a.useRef(null),i=a.useRef(0),[d,u]=a.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),f=Se(d.viewport,d.content),c={...o,sizes:d,onSizesChange:u,hasThumb:f>0&&f<1,onThumbChange:m=>l.current=m,onThumbPointerUp:()=>i.current=0,onThumbPointerDown:m=>i.current=m};function p(m,b){return Ue(m,i.current,d,b)}return t==="horizontal"?r.jsx(Ie,{...c,ref:n,onThumbPositionChange:()=>{if(s.viewport&&l.current){const m=s.viewport.scrollLeft,b=ae(m,d,s.dir);l.current.style.transform=`translate3d(${b}px, 0, 0)`}},onWheelScroll:m=>{s.viewport&&(s.viewport.scrollLeft=m)},onDragScroll:m=>{s.viewport&&(s.viewport.scrollLeft=p(m,s.dir))}}):t==="vertical"?r.jsx(We,{...c,ref:n,onThumbPositionChange:()=>{if(s.viewport&&l.current){const m=s.viewport.scrollTop,b=ae(m,d);l.current.style.transform=`translate3d(0, ${b}px, 0)`}},onWheelScroll:m=>{s.viewport&&(s.viewport.scrollTop=m)},onDragScroll:m=>{s.viewport&&(s.viewport.scrollTop=p(m))}}):null}),Ie=a.forwardRef((e,n)=>{const{sizes:t,onSizesChange:o,...s}=e,l=y(C,e.__scopeScrollArea),[i,d]=a.useState(),u=a.useRef(null),f=k(n,u,l.onScrollbarXChange);return a.useEffect(()=>{u.current&&d(getComputedStyle(u.current))},[u]),r.jsx(be,{"data-orientation":"horizontal",...s,ref:f,sizes:t,style:{bottom:0,left:l.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:l.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":K(t)+"px",...e.style},onThumbPointerDown:c=>e.onThumbPointerDown(c.x),onDragScroll:c=>e.onDragScroll(c.x),onWheelScroll:(c,p)=>{if(l.viewport){const m=l.viewport.scrollLeft+c.deltaX;e.onWheelScroll(m),ge(m,p)&&c.preventDefault()}},onResize:()=>{u.current&&l.viewport&&i&&o({content:l.viewport.scrollWidth,viewport:l.viewport.offsetWidth,scrollbar:{size:u.current.clientWidth,paddingStart:Q(i.paddingLeft),paddingEnd:Q(i.paddingRight)}})}})}),We=a.forwardRef((e,n)=>{const{sizes:t,onSizesChange:o,...s}=e,l=y(C,e.__scopeScrollArea),[i,d]=a.useState(),u=a.useRef(null),f=k(n,u,l.onScrollbarYChange);return a.useEffect(()=>{u.current&&d(getComputedStyle(u.current))},[u]),r.jsx(be,{"data-orientation":"vertical",...s,ref:f,sizes:t,style:{top:0,right:l.dir==="ltr"?0:void 0,left:l.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":K(t)+"px",...e.style},onThumbPointerDown:c=>e.onThumbPointerDown(c.y),onDragScroll:c=>e.onDragScroll(c.y),onWheelScroll:(c,p)=>{if(l.viewport){const m=l.viewport.scrollTop+c.deltaY;e.onWheelScroll(m),ge(m,p)&&c.preventDefault()}},onResize:()=>{u.current&&l.viewport&&i&&o({content:l.viewport.scrollHeight,viewport:l.viewport.offsetHeight,scrollbar:{size:u.current.clientHeight,paddingStart:Q(i.paddingTop),paddingEnd:Q(i.paddingBottom)}})}})}),[Fe,pe]=ce(C),be=a.forwardRef((e,n)=>{const{__scopeScrollArea:t,sizes:o,hasThumb:s,onThumbChange:l,onThumbPointerUp:i,onThumbPointerDown:d,onThumbPositionChange:u,onDragScroll:f,onWheelScroll:c,onResize:p,...m}=e,b=y(C,t),[S,T]=a.useState(null),E=k(n,x=>T(x)),v=a.useRef(null),N=a.useRef(""),P=b.viewport,j=o.content-o.viewport,A=_(c),R=_(u),z=G(p,10);function O(x){if(v.current){const g=x.clientX-v.current.left,h=x.clientY-v.current.top;f({x:g,y:h})}}return a.useEffect(()=>{const x=g=>{const h=g.target;S?.contains(h)&&A(g,j)};return document.addEventListener("wheel",x,{passive:!1}),()=>document.removeEventListener("wheel",x,{passive:!1})},[P,S,j,A]),a.useEffect(R,[o,R]),M(S,z),M(b.content,z),r.jsx(Fe,{scope:t,scrollbar:S,hasThumb:s,onThumbChange:_(l),onThumbPointerUp:_(i),onThumbPositionChange:R,onThumbPointerDown:_(d),children:r.jsx(H.div,{...m,ref:E,style:{position:"absolute",...m.style},onPointerDown:D(e.onPointerDown,x=>{x.button===0&&(x.target.setPointerCapture(x.pointerId),v.current=S.getBoundingClientRect(),N.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",b.viewport&&(b.viewport.style.scrollBehavior="auto"),O(x))}),onPointerMove:D(e.onPointerMove,O),onPointerUp:D(e.onPointerUp,x=>{const g=x.target;g.hasPointerCapture(x.pointerId)&&g.releasePointerCapture(x.pointerId),document.body.style.webkitUserSelect=N.current,b.viewport&&(b.viewport.style.scrollBehavior=""),v.current=null})})})}),q="ScrollAreaThumb",xe=a.forwardRef((e,n)=>{const{forceMount:t,...o}=e,s=pe(q,e.__scopeScrollArea);return r.jsx($,{present:t||s.hasThumb,children:r.jsx(Ye,{ref:n,...o})})}),Ye=a.forwardRef((e,n)=>{const{__scopeScrollArea:t,style:o,...s}=e,l=y(q,t),i=pe(q,t),{onThumbPositionChange:d}=i,u=k(n,p=>i.onThumbChange(p)),f=a.useRef(void 0),c=G(()=>{f.current&&(f.current(),f.current=void 0)},100);return a.useEffect(()=>{const p=l.viewport;if(p){const m=()=>{if(c(),!f.current){const b=Ve(p,d);f.current=b,d()}};return d(),p.addEventListener("scroll",m),()=>p.removeEventListener("scroll",m)}},[l.viewport,c,d]),r.jsx(H.div,{"data-state":i.hasThumb?"visible":"hidden",...s,ref:u,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...o},onPointerDownCapture:D(e.onPointerDownCapture,p=>{const b=p.target.getBoundingClientRect(),S=p.clientX-b.left,T=p.clientY-b.top;i.onThumbPointerDown({x:S,y:T})}),onPointerUp:D(e.onPointerUp,i.onThumbPointerUp)})});xe.displayName=q;var ne="ScrollAreaCorner",ve=a.forwardRef((e,n)=>{const t=y(ne,e.__scopeScrollArea),o=!!(t.scrollbarX&&t.scrollbarY);return t.type!=="scroll"&&o?r.jsx(Be,{...e,ref:n}):null});ve.displayName=ne;var Be=a.forwardRef((e,n)=>{const{__scopeScrollArea:t,...o}=e,s=y(ne,t),[l,i]=a.useState(0),[d,u]=a.useState(0),f=!!(l&&d);return M(s.scrollbarX,()=>{const c=s.scrollbarX?.offsetHeight||0;s.onCornerHeightChange(c),u(c)}),M(s.scrollbarY,()=>{const c=s.scrollbarY?.offsetWidth||0;s.onCornerWidthChange(c),i(c)}),f?r.jsx(H.div,{...o,ref:n,style:{width:l,height:d,position:"absolute",right:s.dir==="ltr"?0:void 0,left:s.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function Q(e){return e?parseInt(e,10):0}function Se(e,n){const t=e/n;return isNaN(t)?0:t}function K(e){const n=Se(e.viewport,e.content),t=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,o=(e.scrollbar.size-t)*n;return Math.max(o,18)}function Ue(e,n,t,o="ltr"){const s=K(t),l=s/2,i=n||l,d=s-i,u=t.scrollbar.paddingStart+i,f=t.scrollbar.size-t.scrollbar.paddingEnd-d,c=t.content-t.viewport,p=o==="ltr"?[0,c]:[c*-1,0];return we([u,f],p)(e)}function ae(e,n,t="ltr"){const o=K(n),s=n.scrollbar.paddingStart+n.scrollbar.paddingEnd,l=n.scrollbar.size-s,i=n.content-n.viewport,d=l-o,u=t==="ltr"?[0,i]:[i*-1,0],f=De(e,u);return we([0,i],[0,d])(f)}function we(e,n){return t=>{if(e[0]===e[1]||n[0]===n[1])return n[0];const o=(n[1]-n[0])/(e[1]-e[0]);return n[0]+o*(t-e[0])}}function ge(e,n){return e>0&&e<n}var Ve=(e,n=()=>{})=>{let t={left:e.scrollLeft,top:e.scrollTop},o=0;return(function s(){const l={left:e.scrollLeft,top:e.scrollTop},i=t.left!==l.left,d=t.top!==l.top;(i||d)&&n(),t=l,o=window.requestAnimationFrame(s)})(),()=>window.cancelAnimationFrame(o)};function G(e,n){const t=_(e),o=a.useRef(0);return a.useEffect(()=>()=>window.clearTimeout(o.current),[]),a.useCallback(()=>{window.clearTimeout(o.current),o.current=window.setTimeout(t,n)},[t,n])}function M(e,n){const t=_(n);Ae(()=>{let o=0;if(e){const s=new ResizeObserver(()=>{cancelAnimationFrame(o),o=window.requestAnimationFrame(t)});return s.observe(e),()=>{window.cancelAnimationFrame(o),s.unobserve(e)}}},[e,t])}var Xe=de,qe=he,Qe=ve;function $e({className:e,children:n,orientation:t="vertical",...o}){return r.jsxs(Xe,{"data-slot":"scroll-area",className:I("relative",e),...o,children:[r.jsx(qe,{"data-slot":"scroll-area-viewport",className:I("focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",t==="horizontal"&&"overflow-x-auto!"),children:n}),r.jsx(Ke,{orientation:t}),r.jsx(Qe,{})]})}function Ke({className:e,orientation:n="vertical",...t}){return r.jsx(fe,{"data-slot":"scroll-area-scrollbar",orientation:n,className:I("flex touch-none p-px transition-colors select-none",n==="vertical"&&"h-full w-2.5 border-l border-l-transparent",n==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",e),...t,children:r.jsx(xe,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}var Ge="Separator",ie="horizontal",Je=["horizontal","vertical"],ye=a.forwardRef((e,n)=>{const{decorative:t,orientation:o=ie,...s}=e,l=Ze(o)?o:ie,d=t?{role:"none"}:{"aria-orientation":l==="vertical"?l:void 0,role:"separator"};return r.jsx(H.div,{"data-orientation":l,...d,...s,ref:n})});ye.displayName=Ge;function Ze(e){return Je.includes(e)}var er=ye;function rr({className:e,orientation:n="horizontal",decorative:t=!0,...o}){return r.jsx(er,{"data-slot":"separator",decorative:t,orientation:n,className:I("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:w-px",e),...o})}function fr(){const{auth:e}=Pe(),n=Ee(),t=Re.useSearch(),[o,s]=a.useState(t.file||null),[l,i]=a.useState(""),[d,u]=a.useState(!1),[f,c]=a.useState(null),{data:p,isLoading:m,isError:b}=F({queryKey:["profile"],queryFn:_e,enabled:!!e.accessToken,staleTime:300*1e3}),S=!!p?.is_admin,T=a.useMemo(()=>new Intl.DateTimeFormat("zh-CN",{dateStyle:"medium",timeStyle:"short",hour12:!1}),[]),E=F({queryKey:["rule-files"],queryFn:async()=>(await Y.get("/api/rules")).data,enabled:!!(e.accessToken&&S),staleTime:60*1e3});a.useEffect(()=>{if(!S||o||t.file)return;const h=E.data?.files?.[0]?.name;h&&s(h)},[S,E.data,o,t.file]);const v=F({queryKey:["rule-file",o],queryFn:async()=>o?(await Y.get(`/api/rules/${encodeURIComponent(o)}`)).data:null,enabled:!!(o&&e.accessToken&&S),refetchOnWindowFocus:!1});a.useEffect(()=>{v.data&&(i(v.data.content??""),u(!1),c(null))},[v.data]);const N=F({queryKey:["rule-history",o],queryFn:async()=>o?(await Y.get(`/api/rules/${encodeURIComponent(o)}/history`)).data:{history:[]},enabled:!!(o&&e.accessToken&&S)}),P=Le({mutationFn:async h=>(await Y.put(`/api/rules/${encodeURIComponent(h.file)}`,{content:h.content})).data,onSuccess:(h,w)=>{se.success("规则已保存"),u(!1),c(null),n.invalidateQueries({queryKey:["rule-files"]}),n.invalidateQueries({queryKey:["rule-file",w.file]}),n.invalidateQueries({queryKey:["rule-history",w.file]})},onError:h=>{Te(h)}}),j=v.isLoading||v.isFetching,A=E.data?.files??[],R=N.data?.history??[],z=a.useMemo(()=>({"subscribe.yaml":["Clash Mobile"],"subscribe-openclash-redirhost.yaml":["OpenClash-RedirHost"],"subscribe-openclash-fakeip.yaml":["OpenClash-Fakeip"]}),[]);a.useEffect(()=>{if(!o){c(null);return}if(j)return;const h=setTimeout(()=>{if(!l.trim()){c("内容不能为空");return}try{le(l),c(null)}catch(W){const je=W instanceof Error?W.message:"YAML 解析失败";c(je)}},300);return()=>{clearTimeout(h)}},[l,o,j]);const O=h=>{h!==o&&(s(h),i(""),u(!1),c(null))},x=()=>{if(o){try{le(l||""),c(null)}catch(h){const w=h instanceof Error?h.message:"YAML 解析失败";c(w),se.error("保存失败，YAML 格式错误");return}P.mutate({file:o,content:l})}},g=()=>{v.data&&(i(v.data.content??""),u(!1),c(null))};return m?r.jsxs("div",{className:"min-h-svh bg-background",children:[r.jsx(Z,{}),r.jsx("main",{className:"mx-auto w-full max-w-6xl px-4 py-8 sm:px-6",children:r.jsx(L,{className:"h-48 w-full"})})]}):!S||b?r.jsxs("div",{className:"min-h-svh bg-background",children:[r.jsx(Z,{}),r.jsx("main",{className:"mx-auto flex w-full max-w-3xl flex-col items-center justify-center gap-4 px-4 py-20 text-center sm:px-6",children:r.jsx(B,{className:"w-full shadow-none border-dashed",children:r.jsxs(U,{children:[r.jsx(V,{children:"权限不足"}),r.jsx(X,{children:"只有管理员可以访问规则配置页面。"})]})})})]}):r.jsxs("div",{className:"min-h-svh bg-background",children:[r.jsx(Z,{}),r.jsxs("main",{className:"mx-auto w-full max-w-6xl px-4 py-8 sm:px-6",children:[r.jsxs("section",{className:"space-y-4",children:[r.jsx("h1",{className:"text-3xl font-semibold tracking-tight",children:"规则配置"}),r.jsx("p",{className:"text-muted-foreground",children:"查看、编辑并保存订阅规则，支持版本历史留存。"})]}),r.jsxs("section",{className:"mt-8 grid gap-6 lg:grid-cols-[320px_1fr]",children:[r.jsxs(B,{children:[r.jsxs(U,{children:[r.jsx(V,{className:"text-base",children:"规则文件"}),r.jsx(X,{children:"选择需要编辑的 YAML 文件"})]}),r.jsx(ee,{children:E.isLoading?r.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((h,w)=>r.jsx(L,{className:"h-10 w-full rounded-md"},w))}):A.length===0?r.jsx("p",{className:"text-sm text-muted-foreground",children:"未找到任何 YAML 文件。"}):r.jsx("div",{className:"space-y-2",children:A.map(h=>{const w=z[h.name],W=w?.length?w.join(" / "):h.name;return r.jsxs(J,{variant:h.name===o?"secondary":"ghost",className:I("w-full justify-between text-left font-normal"),onClick:()=>O(h.name),title:h.name,children:[r.jsx("span",{children:W}),h.latest_version>0?r.jsxs(re,{variant:"outline",children:["v",h.latest_version]}):null]},h.name)})})})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs(B,{children:[r.jsxs(U,{className:"space-y-2",children:[r.jsxs(V,{className:"flex items-center justify-between",children:[r.jsx("span",{children:o??"未选择文件"}),r.jsx("span",{className:"flex items-center gap-2",children:v.data?.latest_version?r.jsxs(re,{variant:"secondary",children:["最新版本 v",v.data.latest_version]}):null})]}),r.jsx(X,{children:"编辑内容时会自动校验 YAML 格式"})]}),r.jsxs(ee,{className:"space-y-4",children:[r.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[r.jsx(J,{size:"sm",onClick:x,disabled:!o||!d||P.isPending||j,children:P.isPending?"保存中...":"保存修改"}),r.jsx(J,{size:"sm",variant:"outline",disabled:!d||j||P.isPending,onClick:g,children:"还原修改"}),r.jsx("span",{className:"text-xs text-muted-foreground",children:"保存后会生成新的历史版本"})]}),f?r.jsx("div",{className:"rounded-md border border-destructive/60 bg-destructive/10 p-3 text-sm text-destructive",children:f}):null,r.jsx("div",{className:"rounded-lg border bg-muted/20",children:j?r.jsxs("div",{className:"space-y-3 p-4",children:[r.jsx(L,{className:"h-4 w-3/4"}),r.jsx(L,{className:"h-4 w-full"}),r.jsx(L,{className:"h-4 w-5/6"}),r.jsx(L,{className:"h-4 w-4/6"})]}):r.jsx(ze,{value:l,onChange:h=>{const w=h.target.value;i(w),u(w!==(v.data?.content??"")),f&&c(null)},className:"min-h-[420px] font-mono text-sm",disabled:!o||P.isPending,spellCheck:!1})})]})]}),r.jsxs(B,{children:[r.jsxs(U,{children:[r.jsx(V,{className:"text-base",children:"历史版本"}),r.jsx(X,{children:"最近保存的版本会在此展示"})]}),r.jsx(ee,{children:N.isLoading?r.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((h,w)=>r.jsx(L,{className:"h-12 w-full rounded-md"},w))}):R.length===0?r.jsx("p",{className:"text-sm text-muted-foreground",children:"暂无历史记录，保存后会自动生成版本。"}):r.jsx($e,{className:"h-64 pr-3",children:r.jsx("div",{className:"space-y-4",children:R.map(h=>r.jsxs("div",{className:"space-y-2 rounded-md border p-3",children:[r.jsxs("div",{className:"flex items-center justify-between text-sm font-medium",children:[r.jsxs("span",{children:["版本 v",h.version]}),r.jsx(re,{variant:"outline",children:h.created_by})]}),r.jsx("div",{className:"text-xs text-muted-foreground",children:h.created_at?T.format(new Date(h.created_at)):"时间未知"}),r.jsx(rr,{className:"my-2"}),r.jsx("pre",{className:"max-h-32 overflow-auto whitespace-pre-wrap break-words rounded bg-muted/40 p-2 text-xs",children:h.content})]},h.version))})})})]})]})]})]})]})}export{fr as component};
