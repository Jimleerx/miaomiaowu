import{r as n,j as e,c as Nt,d as Ye,u as Tt,a as It,h as Et,t as W}from"./index-BN9BZ8Rr.js";import{s as Je,P as z,t as Qe,a as Be,R as Pt,c as Rt,v as Oe,w as Mt,u as q,x as kt,b as V,r as X,y as At,q as Dt,z as Ot,D as Lt,E as Bt,F as Vt,G as Ht,H as Ft,I as zt,J as $t,e as ce,K as Ut,f as Ve,g as He,T as Te,C as me,h as he,i as xe,j as ge,k as Ie,B as ve,p as Wt}from"./card-DvLCnMS9.js";import{u as Kt}from"./useMutation-tbNEdVwD.js";import{L as Fe,I as ye}from"./label-B6ZwrKZd.js";import{c as ze}from"./index-BdQq_4o_.js";import{u as Gt}from"./index-bCQBNJ7u.js";import{T as qt,a as Yt,b as Ee,c as pe,d as Jt,e as le}from"./table-DsD6oqQc.js";import{P as Qt,T as Xt}from"./trash-2-DSgZEvkc.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Xe=Je("chevron-down",Zt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eo=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],to=Je("chevron-up",eo);var Ze=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),oo="VisuallyHidden",no=n.forwardRef((o,r)=>e.jsx(z.span,{...o,ref:r,style:{...Ze,...o.style}}));no.displayName=oo;var ro=[" ","Enter","ArrowUp","ArrowDown"],so=[" ","Enter"],ae="Select",[Se,be,ao]=Mt(ae),[de]=Rt(ae,[ao,Qe]),_e=Qe(),[io,Z]=de(ae),[lo,co]=de(ae),et=o=>{const{__scopeSelect:r,children:t,open:i,defaultOpen:l,onOpenChange:f,value:a,defaultValue:c,onValueChange:d,dir:m,name:S,autoComplete:E,disabled:D,required:A,form:P}=o,p=_e(r),[y,T]=n.useState(null),[h,j]=n.useState(null),[G,$]=n.useState(!1),te=Nt(m),[H,s]=Be({prop:i,defaultProp:l??!1,onChange:f,caller:ae}),[u,g]=Be({prop:a,defaultProp:c,onChange:d,caller:ae}),w=n.useRef(null),x=y?P||!!y.closest("form"):!0,[M,b]=n.useState(new Set),C=Array.from(M).map(_=>_.props.value).join(";");return e.jsx(Pt,{...p,children:e.jsxs(io,{required:A,scope:r,trigger:y,onTriggerChange:T,valueNode:h,onValueNodeChange:j,valueNodeHasChildren:G,onValueNodeHasChildrenChange:$,contentId:Oe(),value:u,onValueChange:g,open:H,onOpenChange:s,dir:te,triggerPointerDownPosRef:w,disabled:D,children:[e.jsx(Se.Provider,{scope:r,children:e.jsx(lo,{scope:o.__scopeSelect,onNativeOptionAdd:n.useCallback(_=>{b(N=>new Set(N).add(_))},[]),onNativeOptionRemove:n.useCallback(_=>{b(N=>{const I=new Set(N);return I.delete(_),I})},[]),children:t})}),x?e.jsxs(bt,{"aria-hidden":!0,required:A,tabIndex:-1,name:S,autoComplete:E,value:u,onChange:_=>g(_.target.value),disabled:D,form:P,children:[u===void 0?e.jsx("option",{value:""}):null,Array.from(M)]},C):null]})})};et.displayName=ae;var tt="SelectTrigger",ot=n.forwardRef((o,r)=>{const{__scopeSelect:t,disabled:i=!1,...l}=o,f=_e(t),a=Z(tt,t),c=a.disabled||i,d=q(r,a.onTriggerChange),m=be(t),S=n.useRef("touch"),[E,D,A]=jt(p=>{const y=m().filter(j=>!j.disabled),T=y.find(j=>j.value===a.value),h=Ct(y,p,T);h!==void 0&&a.onValueChange(h.value)}),P=p=>{c||(a.onOpenChange(!0),A()),p&&(a.triggerPointerDownPosRef.current={x:Math.round(p.pageX),y:Math.round(p.pageY)})};return e.jsx(kt,{asChild:!0,...f,children:e.jsx(z.button,{type:"button",role:"combobox","aria-controls":a.contentId,"aria-expanded":a.open,"aria-required":a.required,"aria-autocomplete":"none",dir:a.dir,"data-state":a.open?"open":"closed",disabled:c,"data-disabled":c?"":void 0,"data-placeholder":_t(a.value)?"":void 0,...l,ref:d,onClick:V(l.onClick,p=>{p.currentTarget.focus(),S.current!=="mouse"&&P(p)}),onPointerDown:V(l.onPointerDown,p=>{S.current=p.pointerType;const y=p.target;y.hasPointerCapture(p.pointerId)&&y.releasePointerCapture(p.pointerId),p.button===0&&p.ctrlKey===!1&&p.pointerType==="mouse"&&(P(p),p.preventDefault())}),onKeyDown:V(l.onKeyDown,p=>{const y=E.current!=="";!(p.ctrlKey||p.altKey||p.metaKey)&&p.key.length===1&&D(p.key),!(y&&p.key===" ")&&ro.includes(p.key)&&(P(),p.preventDefault())})})})});ot.displayName=tt;var nt="SelectValue",rt=n.forwardRef((o,r)=>{const{__scopeSelect:t,className:i,style:l,children:f,placeholder:a="",...c}=o,d=Z(nt,t),{onValueNodeHasChildrenChange:m}=d,S=f!==void 0,E=q(r,d.onValueNodeChange);return X(()=>{m(S)},[m,S]),e.jsx(z.span,{...c,ref:E,style:{pointerEvents:"none"},children:_t(d.value)?e.jsx(e.Fragment,{children:a}):f})});rt.displayName=nt;var uo="SelectIcon",st=n.forwardRef((o,r)=>{const{__scopeSelect:t,children:i,...l}=o;return e.jsx(z.span,{"aria-hidden":!0,...l,ref:r,children:i||"▼"})});st.displayName=uo;var po="SelectPortal",at=o=>e.jsx(At,{asChild:!0,...o});at.displayName=po;var ie="SelectContent",it=n.forwardRef((o,r)=>{const t=Z(ie,o.__scopeSelect),[i,l]=n.useState();if(X(()=>{l(new DocumentFragment)},[]),!t.open){const f=i;return f?Ye.createPortal(e.jsx(lt,{scope:o.__scopeSelect,children:e.jsx(Se.Slot,{scope:o.__scopeSelect,children:e.jsx("div",{children:o.children})})}),f):null}return e.jsx(ct,{...o,ref:r})});it.displayName=ie;var K=10,[lt,ee]=de(ie),fo="SelectContentImpl",mo=Vt("SelectContent.RemoveScroll"),ct=n.forwardRef((o,r)=>{const{__scopeSelect:t,position:i="item-aligned",onCloseAutoFocus:l,onEscapeKeyDown:f,onPointerDownOutside:a,side:c,sideOffset:d,align:m,alignOffset:S,arrowPadding:E,collisionBoundary:D,collisionPadding:A,sticky:P,hideWhenDetached:p,avoidCollisions:y,...T}=o,h=Z(ie,t),[j,G]=n.useState(null),[$,te]=n.useState(null),H=q(r,v=>G(v)),[s,u]=n.useState(null),[g,w]=n.useState(null),x=be(t),[M,b]=n.useState(!1),C=n.useRef(!1);n.useEffect(()=>{if(j)return Ot(j)},[j]),Lt();const _=n.useCallback(v=>{const[O,...U]=x().map(B=>B.ref.current),[R]=U.slice(-1),k=document.activeElement;for(const B of v)if(B===k||(B?.scrollIntoView({block:"nearest"}),B===O&&$&&($.scrollTop=0),B===R&&$&&($.scrollTop=$.scrollHeight),B?.focus(),document.activeElement!==k))return},[x,$]),N=n.useCallback(()=>_([s,j]),[_,s,j]);n.useEffect(()=>{M&&N()},[M,N]);const{onOpenChange:I,triggerPointerDownPosRef:L}=h;n.useEffect(()=>{if(j){let v={x:0,y:0};const O=R=>{v={x:Math.abs(Math.round(R.pageX)-(L.current?.x??0)),y:Math.abs(Math.round(R.pageY)-(L.current?.y??0))}},U=R=>{v.x<=10&&v.y<=10?R.preventDefault():j.contains(R.target)||I(!1),document.removeEventListener("pointermove",O),L.current=null};return L.current!==null&&(document.addEventListener("pointermove",O),document.addEventListener("pointerup",U,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",O),document.removeEventListener("pointerup",U,{capture:!0})}}},[j,I,L]),n.useEffect(()=>{const v=()=>I(!1);return window.addEventListener("blur",v),window.addEventListener("resize",v),()=>{window.removeEventListener("blur",v),window.removeEventListener("resize",v)}},[I]);const[Y,oe]=jt(v=>{const O=x().filter(k=>!k.disabled),U=O.find(k=>k.ref.current===document.activeElement),R=Ct(O,v,U);R&&setTimeout(()=>R.ref.current.focus())}),ue=n.useCallback((v,O,U)=>{const R=!C.current&&!U;(h.value!==void 0&&h.value===O||R)&&(u(v),R&&(C.current=!0))},[h.value]),F=n.useCallback(()=>j?.focus(),[j]),J=n.useCallback((v,O,U)=>{const R=!C.current&&!U;(h.value!==void 0&&h.value===O||R)&&w(v)},[h.value]),Q=i==="popper"?Re:dt,ne=Q===Re?{side:c,sideOffset:d,align:m,alignOffset:S,arrowPadding:E,collisionBoundary:D,collisionPadding:A,sticky:P,hideWhenDetached:p,avoidCollisions:y}:{};return e.jsx(lt,{scope:t,content:j,viewport:$,onViewportChange:te,itemRefCallback:ue,selectedItem:s,onItemLeave:F,itemTextRefCallback:J,focusSelectedItem:N,selectedItemText:g,position:i,isPositioned:M,searchRef:Y,children:e.jsx(Bt,{as:mo,allowPinchZoom:!0,children:e.jsx(Ht,{asChild:!0,trapped:h.open,onMountAutoFocus:v=>{v.preventDefault()},onUnmountAutoFocus:V(l,v=>{h.trigger?.focus({preventScroll:!0}),v.preventDefault()}),children:e.jsx(Ft,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:f,onPointerDownOutside:a,onFocusOutside:v=>v.preventDefault(),onDismiss:()=>h.onOpenChange(!1),children:e.jsx(Q,{role:"listbox",id:h.contentId,"data-state":h.open?"open":"closed",dir:h.dir,onContextMenu:v=>v.preventDefault(),...T,...ne,onPlaced:()=>b(!0),ref:H,style:{display:"flex",flexDirection:"column",outline:"none",...T.style},onKeyDown:V(T.onKeyDown,v=>{const O=v.ctrlKey||v.altKey||v.metaKey;if(v.key==="Tab"&&v.preventDefault(),!O&&v.key.length===1&&oe(v.key),["ArrowUp","ArrowDown","Home","End"].includes(v.key)){let R=x().filter(k=>!k.disabled).map(k=>k.ref.current);if(["ArrowUp","End"].includes(v.key)&&(R=R.slice().reverse()),["ArrowUp","ArrowDown"].includes(v.key)){const k=v.target,B=R.indexOf(k);R=R.slice(B+1)}setTimeout(()=>_(R)),v.preventDefault()}})})})})})})});ct.displayName=fo;var ho="SelectItemAlignedPosition",dt=n.forwardRef((o,r)=>{const{__scopeSelect:t,onPlaced:i,...l}=o,f=Z(ie,t),a=ee(ie,t),[c,d]=n.useState(null),[m,S]=n.useState(null),E=q(r,H=>S(H)),D=be(t),A=n.useRef(!1),P=n.useRef(!0),{viewport:p,selectedItem:y,selectedItemText:T,focusSelectedItem:h}=a,j=n.useCallback(()=>{if(f.trigger&&f.valueNode&&c&&m&&p&&y&&T){const H=f.trigger.getBoundingClientRect(),s=m.getBoundingClientRect(),u=f.valueNode.getBoundingClientRect(),g=T.getBoundingClientRect();if(f.dir!=="rtl"){const k=g.left-s.left,B=u.left-k,re=H.left-B,se=H.width+re,je=Math.max(se,s.width),Ce=window.innerWidth-K,Ne=ze(B,[K,Math.max(K,Ce-je)]);c.style.minWidth=se+"px",c.style.left=Ne+"px"}else{const k=s.right-g.right,B=window.innerWidth-u.right-k,re=window.innerWidth-H.right-B,se=H.width+re,je=Math.max(se,s.width),Ce=window.innerWidth-K,Ne=ze(B,[K,Math.max(K,Ce-je)]);c.style.minWidth=se+"px",c.style.right=Ne+"px"}const w=D(),x=window.innerHeight-K*2,M=p.scrollHeight,b=window.getComputedStyle(m),C=parseInt(b.borderTopWidth,10),_=parseInt(b.paddingTop,10),N=parseInt(b.borderBottomWidth,10),I=parseInt(b.paddingBottom,10),L=C+_+M+I+N,Y=Math.min(y.offsetHeight*5,L),oe=window.getComputedStyle(p),ue=parseInt(oe.paddingTop,10),F=parseInt(oe.paddingBottom,10),J=H.top+H.height/2-K,Q=x-J,ne=y.offsetHeight/2,v=y.offsetTop+ne,O=C+_+v,U=L-O;if(O<=J){const k=w.length>0&&y===w[w.length-1].ref.current;c.style.bottom="0px";const B=m.clientHeight-p.offsetTop-p.offsetHeight,re=Math.max(Q,ne+(k?F:0)+B+N),se=O+re;c.style.height=se+"px"}else{const k=w.length>0&&y===w[0].ref.current;c.style.top="0px";const re=Math.max(J,C+p.offsetTop+(k?ue:0)+ne)+U;c.style.height=re+"px",p.scrollTop=O-J+p.offsetTop}c.style.margin=`${K}px 0`,c.style.minHeight=Y+"px",c.style.maxHeight=x+"px",i?.(),requestAnimationFrame(()=>A.current=!0)}},[D,f.trigger,f.valueNode,c,m,p,y,T,f.dir,i]);X(()=>j(),[j]);const[G,$]=n.useState();X(()=>{m&&$(window.getComputedStyle(m).zIndex)},[m]);const te=n.useCallback(H=>{H&&P.current===!0&&(j(),h?.(),P.current=!1)},[j,h]);return e.jsx(go,{scope:t,contentWrapper:c,shouldExpandOnScrollRef:A,onScrollButtonChange:te,children:e.jsx("div",{ref:d,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:G},children:e.jsx(z.div,{...l,ref:E,style:{boxSizing:"border-box",maxHeight:"100%",...l.style}})})})});dt.displayName=ho;var xo="SelectPopperPosition",Re=n.forwardRef((o,r)=>{const{__scopeSelect:t,align:i="start",collisionPadding:l=K,...f}=o,a=_e(t);return e.jsx(zt,{...a,...f,ref:r,align:i,collisionPadding:l,style:{boxSizing:"border-box",...f.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Re.displayName=xo;var[go,Le]=de(ie,{}),Me="SelectViewport",ut=n.forwardRef((o,r)=>{const{__scopeSelect:t,nonce:i,...l}=o,f=ee(Me,t),a=Le(Me,t),c=q(r,f.onViewportChange),d=n.useRef(0);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:i}),e.jsx(Se.Slot,{scope:t,children:e.jsx(z.div,{"data-radix-select-viewport":"",role:"presentation",...l,ref:c,style:{position:"relative",flex:1,overflow:"hidden auto",...l.style},onScroll:V(l.onScroll,m=>{const S=m.currentTarget,{contentWrapper:E,shouldExpandOnScrollRef:D}=a;if(D?.current&&E){const A=Math.abs(d.current-S.scrollTop);if(A>0){const P=window.innerHeight-K*2,p=parseFloat(E.style.minHeight),y=parseFloat(E.style.height),T=Math.max(p,y);if(T<P){const h=T+A,j=Math.min(P,h),G=h-j;E.style.height=j+"px",E.style.bottom==="0px"&&(S.scrollTop=G>0?G:0,E.style.justifyContent="flex-end")}}}d.current=S.scrollTop})})})]})});ut.displayName=Me;var pt="SelectGroup",[vo,yo]=de(pt),wo=n.forwardRef((o,r)=>{const{__scopeSelect:t,...i}=o,l=Oe();return e.jsx(vo,{scope:t,id:l,children:e.jsx(z.div,{role:"group","aria-labelledby":l,...i,ref:r})})});wo.displayName=pt;var ft="SelectLabel",So=n.forwardRef((o,r)=>{const{__scopeSelect:t,...i}=o,l=yo(ft,t);return e.jsx(z.div,{id:l.id,...i,ref:r})});So.displayName=ft;var we="SelectItem",[bo,mt]=de(we),ht=n.forwardRef((o,r)=>{const{__scopeSelect:t,value:i,disabled:l=!1,textValue:f,...a}=o,c=Z(we,t),d=ee(we,t),m=c.value===i,[S,E]=n.useState(f??""),[D,A]=n.useState(!1),P=q(r,h=>d.itemRefCallback?.(h,i,l)),p=Oe(),y=n.useRef("touch"),T=()=>{l||(c.onValueChange(i),c.onOpenChange(!1))};if(i==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return e.jsx(bo,{scope:t,value:i,disabled:l,textId:p,isSelected:m,onItemTextChange:n.useCallback(h=>{E(j=>j||(h?.textContent??"").trim())},[]),children:e.jsx(Se.ItemSlot,{scope:t,value:i,disabled:l,textValue:S,children:e.jsx(z.div,{role:"option","aria-labelledby":p,"data-highlighted":D?"":void 0,"aria-selected":m&&D,"data-state":m?"checked":"unchecked","aria-disabled":l||void 0,"data-disabled":l?"":void 0,tabIndex:l?void 0:-1,...a,ref:P,onFocus:V(a.onFocus,()=>A(!0)),onBlur:V(a.onBlur,()=>A(!1)),onClick:V(a.onClick,()=>{y.current!=="mouse"&&T()}),onPointerUp:V(a.onPointerUp,()=>{y.current==="mouse"&&T()}),onPointerDown:V(a.onPointerDown,h=>{y.current=h.pointerType}),onPointerMove:V(a.onPointerMove,h=>{y.current=h.pointerType,l?d.onItemLeave?.():y.current==="mouse"&&h.currentTarget.focus({preventScroll:!0})}),onPointerLeave:V(a.onPointerLeave,h=>{h.currentTarget===document.activeElement&&d.onItemLeave?.()}),onKeyDown:V(a.onKeyDown,h=>{d.searchRef?.current!==""&&h.key===" "||(so.includes(h.key)&&T(),h.key===" "&&h.preventDefault())})})})})});ht.displayName=we;var fe="SelectItemText",xt=n.forwardRef((o,r)=>{const{__scopeSelect:t,className:i,style:l,...f}=o,a=Z(fe,t),c=ee(fe,t),d=mt(fe,t),m=co(fe,t),[S,E]=n.useState(null),D=q(r,T=>E(T),d.onItemTextChange,T=>c.itemTextRefCallback?.(T,d.value,d.disabled)),A=S?.textContent,P=n.useMemo(()=>e.jsx("option",{value:d.value,disabled:d.disabled,children:A},d.value),[d.disabled,d.value,A]),{onNativeOptionAdd:p,onNativeOptionRemove:y}=m;return X(()=>(p(P),()=>y(P)),[p,y,P]),e.jsxs(e.Fragment,{children:[e.jsx(z.span,{id:d.textId,...f,ref:D}),d.isSelected&&a.valueNode&&!a.valueNodeHasChildren?Ye.createPortal(f.children,a.valueNode):null]})});xt.displayName=fe;var gt="SelectItemIndicator",vt=n.forwardRef((o,r)=>{const{__scopeSelect:t,...i}=o;return mt(gt,t).isSelected?e.jsx(z.span,{"aria-hidden":!0,...i,ref:r}):null});vt.displayName=gt;var ke="SelectScrollUpButton",yt=n.forwardRef((o,r)=>{const t=ee(ke,o.__scopeSelect),i=Le(ke,o.__scopeSelect),[l,f]=n.useState(!1),a=q(r,i.onScrollButtonChange);return X(()=>{if(t.viewport&&t.isPositioned){let c=function(){const m=d.scrollTop>0;f(m)};const d=t.viewport;return c(),d.addEventListener("scroll",c),()=>d.removeEventListener("scroll",c)}},[t.viewport,t.isPositioned]),l?e.jsx(St,{...o,ref:a,onAutoScroll:()=>{const{viewport:c,selectedItem:d}=t;c&&d&&(c.scrollTop=c.scrollTop-d.offsetHeight)}}):null});yt.displayName=ke;var Ae="SelectScrollDownButton",wt=n.forwardRef((o,r)=>{const t=ee(Ae,o.__scopeSelect),i=Le(Ae,o.__scopeSelect),[l,f]=n.useState(!1),a=q(r,i.onScrollButtonChange);return X(()=>{if(t.viewport&&t.isPositioned){let c=function(){const m=d.scrollHeight-d.clientHeight,S=Math.ceil(d.scrollTop)<m;f(S)};const d=t.viewport;return c(),d.addEventListener("scroll",c),()=>d.removeEventListener("scroll",c)}},[t.viewport,t.isPositioned]),l?e.jsx(St,{...o,ref:a,onAutoScroll:()=>{const{viewport:c,selectedItem:d}=t;c&&d&&(c.scrollTop=c.scrollTop+d.offsetHeight)}}):null});wt.displayName=Ae;var St=n.forwardRef((o,r)=>{const{__scopeSelect:t,onAutoScroll:i,...l}=o,f=ee("SelectScrollButton",t),a=n.useRef(null),c=be(t),d=n.useCallback(()=>{a.current!==null&&(window.clearInterval(a.current),a.current=null)},[]);return n.useEffect(()=>()=>d(),[d]),X(()=>{c().find(S=>S.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[c]),e.jsx(z.div,{"aria-hidden":!0,...l,ref:r,style:{flexShrink:0,...l.style},onPointerDown:V(l.onPointerDown,()=>{a.current===null&&(a.current=window.setInterval(i,50))}),onPointerMove:V(l.onPointerMove,()=>{f.onItemLeave?.(),a.current===null&&(a.current=window.setInterval(i,50))}),onPointerLeave:V(l.onPointerLeave,()=>{d()})})}),_o="SelectSeparator",jo=n.forwardRef((o,r)=>{const{__scopeSelect:t,...i}=o;return e.jsx(z.div,{"aria-hidden":!0,...i,ref:r})});jo.displayName=_o;var De="SelectArrow",Co=n.forwardRef((o,r)=>{const{__scopeSelect:t,...i}=o,l=_e(t),f=Z(De,t),a=ee(De,t);return f.open&&a.position==="popper"?e.jsx($t,{...l,...i,ref:r}):null});Co.displayName=De;var No="SelectBubbleInput",bt=n.forwardRef(({__scopeSelect:o,value:r,...t},i)=>{const l=n.useRef(null),f=q(i,l),a=Gt(r);return n.useEffect(()=>{const c=l.current;if(!c)return;const d=window.HTMLSelectElement.prototype,S=Object.getOwnPropertyDescriptor(d,"value").set;if(a!==r&&S){const E=new Event("change",{bubbles:!0});S.call(c,r),c.dispatchEvent(E)}},[a,r]),e.jsx(z.select,{...t,style:{...Ze,...t.style},ref:f,defaultValue:r})});bt.displayName=No;function _t(o){return o===""||o===void 0}function jt(o){const r=Dt(o),t=n.useRef(""),i=n.useRef(0),l=n.useCallback(a=>{const c=t.current+a;r(c),(function d(m){t.current=m,window.clearTimeout(i.current),m!==""&&(i.current=window.setTimeout(()=>d(""),1e3))})(c)},[r]),f=n.useCallback(()=>{t.current="",window.clearTimeout(i.current)},[]);return n.useEffect(()=>()=>window.clearTimeout(i.current),[]),[t,l,f]}function Ct(o,r,t){const l=r.length>1&&Array.from(r).every(m=>m===r[0])?r[0]:r,f=t?o.indexOf(t):-1;let a=To(o,Math.max(f,0));l.length===1&&(a=a.filter(m=>m!==t));const d=a.find(m=>m.textValue.toLowerCase().startsWith(l.toLowerCase()));return d!==t?d:void 0}function To(o,r){return o.map((t,i)=>o[(r+i)%o.length])}var Io=et,Eo=ot,Po=rt,Ro=st,Mo=at,ko=it,Ao=ut,Do=ht,Oo=xt,Lo=vt,Bo=yt,Vo=wt;function $e({...o}){return e.jsx(Io,{"data-slot":"select",...o})}function Ue({...o}){return e.jsx(Po,{"data-slot":"select-value",...o})}function We({className:o,size:r="default",children:t,...i}){return e.jsxs(Eo,{"data-slot":"select-trigger","data-size":r,className:ce("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",o),...i,children:[t,e.jsx(Ro,{asChild:!0,children:e.jsx(Xe,{className:"size-4 opacity-50"})})]})}function Ke({className:o,children:r,position:t="popper",...i}){return e.jsx(Mo,{children:e.jsxs(ko,{"data-slot":"select-content",className:ce("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",o),position:t,...i,children:[e.jsx(Ho,{}),e.jsx(Ao,{className:ce("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:r}),e.jsx(Fo,{})]})})}function Ge({className:o,children:r,...t}){return e.jsxs(Do,{"data-slot":"select-item",className:ce("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 ps-2 pe-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",o),...t,children:[e.jsx("span",{className:"absolute end-2 flex size-3.5 items-center justify-center",children:e.jsx(Lo,{children:e.jsx(Ut,{className:"size-4"})})}),e.jsx(Oo,{children:r})]})}function Ho({className:o,...r}){return e.jsx(Bo,{"data-slot":"select-scroll-up-button",className:ce("flex cursor-default items-center justify-center py-1",o),...r,children:e.jsx(to,{className:"size-4"})})}function Fo({className:o,...r}){return e.jsx(Vo,{"data-slot":"select-scroll-down-button",className:ce("flex cursor-default items-center justify-center py-1",o),...r,children:e.jsx(Xe,{className:"size-4"})})}const qe=1024**3,Pe=[{value:"nezha",label:"哪吒面板"},{value:"dstatus",label:"DStatus"},{value:"komari",label:"Komari"}],zo=[{value:"both",label:"上下行总和"},{value:"up",label:"仅上行"},{value:"down",label:"仅下行"}];function Qo(){const{auth:o}=Tt(),r=It(),[t,i]=n.useState({probeType:"nezha",address:"",servers:[]}),[l,f]=n.useState(!1),a=()=>typeof crypto<"u"&&crypto?.randomUUID?crypto.randomUUID():Math.random().toString(36).slice(2,10),{data:c,isLoading:d}=Ve({queryKey:["profile"],queryFn:Wt,enabled:!!o.accessToken,staleTime:300*1e3}),m=!!c?.is_admin,{data:S,isLoading:E}=Ve({queryKey:["probe-config"],queryFn:async()=>(await He.get("/api/admin/probe-config")).data,enabled:!!(o.accessToken&&m),staleTime:300*1e3});n.useEffect(()=>{const s=S?.config;if(!s)return;const u=(s.probe_type??"").toLowerCase().trim(),g=Pe[0]?.value??"",w=Pe.some(x=>x.value===u)?u:g;i({probeType:w,address:s.address?.trim()??"",servers:(s.servers??[]).map(x=>({key:`${x.id??x.server_id}-${x.position}`,id:x.id,server_id:x.server_id,name:x.name,traffic_method:x.traffic_method,monthly_traffic_gb:Number.isFinite(x.monthly_traffic_gb)?Number(x.monthly_traffic_gb):0}))})},[S]);const D=n.useMemo(()=>new Intl.DateTimeFormat("zh-CN",{dateStyle:"medium",timeStyle:"short",hour12:!1}),[]),A=n.useMemo(()=>{const s=S?.config?.updated_at;return s?D.format(new Date(s)):null},[S,D]),P=Kt({mutationFn:async()=>{const s={probe_type:t.probeType,address:t.address.trim(),servers:t.servers.map(g=>({server_id:g.server_id.trim(),name:g.name.trim(),traffic_method:g.traffic_method,monthly_traffic_gb:(()=>{if(typeof g.monthly_traffic_gb=="number")return g.monthly_traffic_gb;if(typeof g.monthly_traffic_gb=="string"){const w=g.monthly_traffic_gb.trim();return w?Number(w):0}return 0})()}))};return(await He.put("/api/admin/probe-config",s)).data},onSuccess:s=>{W.success("探针配置已保存"),r.setQueryData(["probe-config"],{config:s.config}),r.invalidateQueries({queryKey:["traffic-summary"]})},onError:Et}),p=(s,u,g)=>{i(w=>{const x=[...w.servers],M=g;let b=M;if(u==="monthly_traffic_gb")if(M===null)b=null;else if(typeof M=="string"){const _=M.trim();b=_===""?null:_}else b=M;const C={...x[s],[u]:b};return x.splice(s,1,C),{...w,servers:x}})},y=()=>{i(s=>({...s,servers:[...s.servers,{key:a(),server_id:"",name:"",traffic_method:"both",monthly_traffic_gb:null}]}))},T=s=>{i(u=>{const g=[...u.servers];return g.splice(s,1),{...u,servers:g}})},h=()=>t.address.trim().replace(/\/$/,""),j=async s=>{const u=await fetch(`${s}/api/servers`);if(!u.ok)throw new Error("服务器接口返回异常");const g=await u.json(),w=Array.isArray(g?.data)?g.data:[];if(w.length===0)return[];const x=w.map(b=>`${b?.id??""}`.trim()).filter(b=>b);let M={};if(x.length>0)try{const b=await fetch(`${s}/stats/batch-traffic`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({serverIds:x})});if(b.ok){const C=await b.json();C?.data&&typeof C.data=="object"&&(M=C.data)}}catch{}return w.map((b,C)=>{const _=`${b?.id??""}`.trim(),N=_?M[_]:void 0;let I=0;const L=N?.monthly?.limit??N?.limit??N?.Monthly?.Limit??N?.Monthly?.limit;if(typeof L=="number")I=Math.max(0,Math.round(L/qe*100)/100);else if(typeof L=="string"){const Y=Number(L);Number.isNaN(Y)||(I=Math.max(0,Math.round(Y/qe*100)/100))}return{key:`${_||"server"}-${C}-${a()}`,server_id:_,name:`${b?.name??""}`.trim()||`服务器 ${C+1}`,traffic_method:"both",monthly_traffic_gb:I}})},G=async s=>{if(typeof window>"u"||typeof WebSocket>"u")throw new Error("当前环境不支持 WebSocket 同步");let u=null,g=null;const w=()=>{g!==null&&(window.clearTimeout(g),g=null)};return new Promise((x,M)=>{let b=!1;const C=(N,I=[])=>{b||(b=!0,w(),u&&u.readyState===WebSocket.OPEN&&u.close(),u=null,N?M(N):x(I))};let _;try{_=new URL("/api/v1/ws/server",s)}catch{C(new Error("探针地址不合法"));return}_.protocol=_.protocol==="https:"?"wss:":"ws:";try{u=new WebSocket(_.toString())}catch{C(new Error("无法连接到 WebSocket 接口"));return}u.onopen=()=>{w(),g=window.setTimeout(()=>{C(new Error("未在期望时间内收到服务器数据"))},5e3)},u.onmessage=async N=>{try{let I;if(typeof N.data=="string")I=N.data;else if(N.data instanceof Blob)I=await N.data.text();else if(N.data instanceof ArrayBuffer)I=new TextDecoder().decode(N.data);else{C(new Error("WebSocket 返回数据格式不支持"));return}const L=JSON.parse(I),Y=Array.isArray(L)?L[L.length-1]??{}:L??{},oe=Array.isArray(Y?.servers)?Y.servers:[];if(oe.length===0){C(new Error("探针未返回任何服务器数据"));return}const ue=oe.map((F,J)=>{let Q="";F?.id!==void 0&&F?.id!==null?Q=String(F.id).trim():F?.server_id!==void 0&&F?.server_id!==null&&(Q=String(F.server_id).trim());const ne=F&&typeof F=="object"&&typeof F.name=="string"?F.name.trim():`服务器 ${J+1}`;return{key:`${Q||"server"}-${J}-${a()}`,server_id:Q,name:ne,traffic_method:"both",monthly_traffic_gb:null}});C(void 0,ue)}catch{C(new Error("解析探针返回数据失败"))}},u.onerror=()=>{C(new Error("WebSocket 连接出错"))},u.onclose=()=>{C(new Error("未收到服务器数据，连接已关闭"))}})},$=async s=>{const u=await fetch(`${s}/api/nodes`);if(!u.ok)throw new Error("服务器接口返回异常");const g=await u.json(),w=Array.isArray(g?.data)?g.data:[];return w.length===0?[]:w.map((x,M)=>{const b=`${x?.uuid??""}`.trim(),C=`${x?.name??""}`.trim()||`服务器 ${M+1}`,_=x?.traffic_limit;let N=null;if(_!=null){const I=Number(_);Number.isFinite(I)&&I>0&&(N=I)}return{key:`${b||"server"}-${M}-${a()}`,server_id:b,name:C,traffic_method:"both",monthly_traffic_gb:N}})},te=async()=>{if(!t.address.trim()){W.error("请先填写探针面板地址");return}f(!0);try{const s=h();let u=[];if(t.probeType==="dstatus")u=await j(s);else if(t.probeType==="nezha")u=await G(s);else if(t.probeType==="komari")u=await $(s);else{W.error("当前探针类型暂不支持自动同步");return}if(u.length===0){W.error("未从面板获取到服务器列表");return}i(g=>({...g,servers:u})),W.success("已从面板同步服务器列表")}catch(s){console.error(s),W.error(s instanceof Error?s.message:"同步服务器失败，请检查面板地址或网络")}finally{f(!1)}},H=s=>{if(s.preventDefault(),!t.address.trim()){W.error("请输入探针地址");return}if(!t.probeType){W.error("请选择探针类型");return}if(t.servers.length===0){W.error("请至少添加一个服务器节点");return}for(const u of t.servers){if(!u.server_id.trim()){W.error("服务器 ID 不能为空");return}if(!u.name.trim()){W.error("服务器名称不能为空");return}if(!u.traffic_method){W.error("请选择流量计算方式");return}const g=(()=>{if(typeof u.monthly_traffic_gb=="number")return u.monthly_traffic_gb;if(typeof u.monthly_traffic_gb=="string"){const w=u.monthly_traffic_gb.trim();return w?Number(w):NaN}return NaN})();if(!Number.isFinite(g)||g<=0){W.error("请填写服务器月流量（GB）");return}}P.mutate()};return d||m&&E?e.jsxs("div",{className:"min-h-svh bg-background",children:[e.jsx(Te,{}),e.jsx("main",{className:"mx-auto w-full max-w-5xl px-4 py-8 sm:px-6",children:e.jsxs(me,{className:"border-dashed shadow-none",children:[e.jsxs(he,{children:[e.jsx(xe,{children:"加载中…"}),e.jsx(ge,{children:"正在读取探针配置，请稍候。"})]}),e.jsx(Ie,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-10 w-full animate-pulse rounded-md bg-muted"}),e.jsx("div",{className:"h-10 w-full animate-pulse rounded-md bg-muted"}),e.jsx("div",{className:"h-10 w-full animate-pulse rounded-md bg-muted"})]})})]})})]}):m?e.jsxs("div",{className:"min-h-svh bg-background",children:[e.jsx(Te,{}),e.jsx("main",{className:"mx-auto w-full max-w-5xl px-4 py-8 sm:px-6",children:e.jsxs("form",{className:"space-y-8",onSubmit:H,children:[e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-semibold tracking-tight",children:"探针数据源"}),e.jsx("p",{className:"text-muted-foreground",children:"配置 traffic 接口所使用的探针类型、面板地址以及参与汇总的服务器列表。"})]}),e.jsx(ve,{type:"submit",disabled:P.isPending,children:P.isPending?"保存中…":"保存配置"})]}),A?e.jsxs("p",{className:"text-sm text-muted-foreground",children:["最近保存：",A]}):null]}),e.jsxs(me,{children:[e.jsxs(he,{children:[e.jsx(xe,{children:"探针信息"}),e.jsx(ge,{children:"支持哪吒、DStatus、Komari 三种探针类型。"})]}),e.jsx(Ie,{className:"space-y-6",children:e.jsxs("div",{className:"grid gap-6 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"probe-type",children:"探针类型"}),e.jsxs($e,{value:t.probeType,onValueChange:s=>i(u=>({...u,probeType:s})),children:[e.jsx(We,{id:"probe-type",children:e.jsx(Ue,{placeholder:"选择探针类型"})}),e.jsx(Ke,{children:Pe.map(s=>e.jsx(Ge,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"probe-address",children:"面板地址"}),e.jsx(ye,{id:"probe-address",value:t.address,onChange:s=>i(u=>({...u,address:s.target.value})),placeholder:"例如：https://panel.example.com"})]})]})})]}),e.jsxs(me,{children:[e.jsxs(he,{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(xe,{children:"服务器列表"}),e.jsx(ge,{children:"根据探针类型填写对应的服务器 ID、名称和流量统计方式。"}),e.jsx("p",{className:"mt-2 text-sm font-semibold text-destructive",children:"请为每个服务器填写月流量（GB），该字段为必填项。"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[["dstatus","nezha","komari"].includes(t.probeType)?e.jsx(ve,{type:"button",variant:"secondary",size:"sm",onClick:te,disabled:l,children:l?"同步中…":"从面板同步"}):null,e.jsxs(ve,{type:"button",variant:"outline",size:"sm",onClick:y,children:[e.jsx(Qt,{className:"mr-2 size-4"}),"新增服务器"]})]})]}),e.jsx(Ie,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(qt,{children:[e.jsx(Yt,{children:e.jsxs(Ee,{children:[e.jsx(pe,{className:"w-[200px]",children:"服务器 ID"}),e.jsx(pe,{className:"w-[200px]",children:"显示名称"}),e.jsx(pe,{className:"w-[160px]",children:"流量统计"}),e.jsx(pe,{className:"w-[160px]",children:e.jsxs("span",{className:"flex items-center gap-1",children:["月流量 (GB)",e.jsx("span",{className:"text-destructive",children:"*"})]})}),e.jsx(pe,{className:"w-[80px]"})]})}),e.jsxs(Jt,{children:[t.servers.map((s,u)=>{const g=typeof s.monthly_traffic_gb=="number"?s.monthly_traffic_gb:typeof s.monthly_traffic_gb=="string"?Number(s.monthly_traffic_gb):NaN,w=!Number.isFinite(g)||g<=0;return e.jsxs(Ee,{children:[e.jsx(le,{children:e.jsx(ye,{value:s.server_id,readOnly:!0,disabled:!0,placeholder:"服务器唯一 ID",className:"bg-muted/60 text-muted-foreground"})}),e.jsx(le,{children:e.jsx(ye,{value:s.name,readOnly:!0,disabled:!0,placeholder:"用于展示的名称",className:"bg-muted/60 text-muted-foreground"})}),e.jsx(le,{children:e.jsxs($e,{value:s.traffic_method,onValueChange:x=>p(u,"traffic_method",x),children:[e.jsx(We,{children:e.jsx(Ue,{})}),e.jsx(Ke,{children:zo.map(x=>e.jsx(Ge,{value:x.value,children:x.label},x.value))})]})}),e.jsxs(le,{children:[e.jsx(ye,{type:"number",inputMode:"decimal",min:0,step:"0.01",value:typeof s.monthly_traffic_gb=="number"?s.monthly_traffic_gb:s.monthly_traffic_gb??"",onChange:x=>p(u,"monthly_traffic_gb",x.target.value),className:w?"border-destructive focus-visible:ring-destructive/80 focus-visible:ring-2":void 0,"aria-invalid":w,placeholder:"必填，单位 GB",required:!0,title:"请填写服务器的月流量（GB）"}),w?e.jsx("p",{className:"mt-1 text-xs font-semibold text-destructive",children:"请输入该服务器的月流量（GB）"}):e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"单位：GB"})]}),e.jsx(le,{className:"text-right",children:e.jsx(ve,{type:"button",variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>T(u),children:e.jsx(Xt,{className:"size-4"})})})]},s.key)}),t.servers.length===0?e.jsx(Ee,{children:e.jsx(le,{colSpan:5,className:"py-10 text-center text-muted-foreground",children:"尚未配置服务器，请点击右上角按钮添加。"})}):null]})]})})})]})]})})]}):e.jsxs("div",{className:"min-h-svh bg-background",children:[e.jsx(Te,{}),e.jsx("main",{className:"mx-auto flex w-full max-w-3xl flex-col items-center justify-center gap-4 px-4 py-20 text-center sm:px-6",children:e.jsx(me,{className:"w-full border-dashed shadow-none",children:e.jsxs(he,{children:[e.jsx(xe,{children:"权限不足"}),e.jsx(ge,{children:"仅管理员可管理探针数据源配置。"})]})})})]})}export{Qo as component};
