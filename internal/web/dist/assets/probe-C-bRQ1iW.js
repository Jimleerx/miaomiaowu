import{r as n,j as e,c as jt,d as qe,u as Nt,a as Tt,h as It,t as H}from"./index-zA5oHG0w.js";import{s as Ye,P as L,t as Qe,a as Ve,R as Pt,c as Et,v as Le,w as Rt,u as $,x as Mt,b as D,r as q,y as Dt,q as kt,z as At,D as Ot,E as Lt,F as Bt,G as Vt,H as Ht,I as Ft,J as zt,e as re,K as Ut,f as He,g as le,T as Ie,C as pe,h as fe,i as me,j as he,k as Pe,B as xe,p as Kt}from"./card-nkvFirOn.js";import{u as $t}from"./useMutation-CaJTbczl.js";import{L as Fe,I as ge}from"./label-DIl0VfAY.js";import{c as ze}from"./index-BdQq_4o_.js";import{u as Wt}from"./index-s15DPCyr.js";import{T as Gt,a as qt,b as Ee,c as ie,d as Yt,e as ne}from"./table-C0BuGcTv.js";import{P as Qt,T as Xt}from"./trash-2-BEUCMi9G.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Xe=Ye("chevron-down",Zt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],eo=Ye("chevron-up",Jt);var Ze=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),to="VisuallyHidden",oo=n.forwardRef((o,r)=>e.jsx(L.span,{...o,ref:r,style:{...Ze,...o.style}}));oo.displayName=to;var no=[" ","Enter","ArrowUp","ArrowDown"],ro=[" ","Enter"],ee="Select",[ye,be,so]=Rt(ee),[se]=Et(ee,[so,Qe]),Se=Qe(),[ao,Y]=se(ee),[lo,io]=se(ee),Je=o=>{const{__scopeSelect:r,children:t,open:l,defaultOpen:i,onOpenChange:p,value:a,defaultValue:c,onValueChange:d,dir:f,name:S,autoComplete:C,disabled:P,required:I,form:j}=o,u=Se(r),[y,_]=n.useState(null),[h,w]=n.useState(null),[U,B]=n.useState(!1),X=jt(f),[k,s]=Ve({prop:l,defaultProp:i??!1,onChange:p,caller:ee}),[m,b]=Ve({prop:a,defaultProp:c,onChange:d,caller:ee}),x=n.useRef(null),g=y?j||!!y.closest("form"):!0,[A,O]=n.useState(new Set),F=Array.from(A).map(M=>M.props.value).join(";");return e.jsx(Pt,{...u,children:e.jsxs(ao,{required:I,scope:r,trigger:y,onTriggerChange:_,valueNode:h,onValueNodeChange:w,valueNodeHasChildren:U,onValueNodeHasChildrenChange:B,contentId:Le(),value:m,onValueChange:b,open:k,onOpenChange:s,dir:X,triggerPointerDownPosRef:x,disabled:P,children:[e.jsx(ye.Provider,{scope:r,children:e.jsx(lo,{scope:o.__scopeSelect,onNativeOptionAdd:n.useCallback(M=>{O(K=>new Set(K).add(M))},[]),onNativeOptionRemove:n.useCallback(M=>{O(K=>{const W=new Set(K);return W.delete(M),W})},[]),children:t})}),g?e.jsxs(St,{"aria-hidden":!0,required:I,tabIndex:-1,name:S,autoComplete:C,value:m,onChange:M=>b(M.target.value),disabled:P,form:j,children:[m===void 0?e.jsx("option",{value:""}):null,Array.from(A)]},F):null]})})};Je.displayName=ee;var et="SelectTrigger",tt=n.forwardRef((o,r)=>{const{__scopeSelect:t,disabled:l=!1,...i}=o,p=Se(t),a=Y(et,t),c=a.disabled||l,d=$(r,a.onTriggerChange),f=be(t),S=n.useRef("touch"),[C,P,I]=_t(u=>{const y=f().filter(w=>!w.disabled),_=y.find(w=>w.value===a.value),h=Ct(y,u,_);h!==void 0&&a.onValueChange(h.value)}),j=u=>{c||(a.onOpenChange(!0),I()),u&&(a.triggerPointerDownPosRef.current={x:Math.round(u.pageX),y:Math.round(u.pageY)})};return e.jsx(Mt,{asChild:!0,...p,children:e.jsx(L.button,{type:"button",role:"combobox","aria-controls":a.contentId,"aria-expanded":a.open,"aria-required":a.required,"aria-autocomplete":"none",dir:a.dir,"data-state":a.open?"open":"closed",disabled:c,"data-disabled":c?"":void 0,"data-placeholder":wt(a.value)?"":void 0,...i,ref:d,onClick:D(i.onClick,u=>{u.currentTarget.focus(),S.current!=="mouse"&&j(u)}),onPointerDown:D(i.onPointerDown,u=>{S.current=u.pointerType;const y=u.target;y.hasPointerCapture(u.pointerId)&&y.releasePointerCapture(u.pointerId),u.button===0&&u.ctrlKey===!1&&u.pointerType==="mouse"&&(j(u),u.preventDefault())}),onKeyDown:D(i.onKeyDown,u=>{const y=C.current!=="";!(u.ctrlKey||u.altKey||u.metaKey)&&u.key.length===1&&P(u.key),!(y&&u.key===" ")&&no.includes(u.key)&&(j(),u.preventDefault())})})})});tt.displayName=et;var ot="SelectValue",nt=n.forwardRef((o,r)=>{const{__scopeSelect:t,className:l,style:i,children:p,placeholder:a="",...c}=o,d=Y(ot,t),{onValueNodeHasChildrenChange:f}=d,S=p!==void 0,C=$(r,d.onValueNodeChange);return q(()=>{f(S)},[f,S]),e.jsx(L.span,{...c,ref:C,style:{pointerEvents:"none"},children:wt(d.value)?e.jsx(e.Fragment,{children:a}):p})});nt.displayName=ot;var co="SelectIcon",rt=n.forwardRef((o,r)=>{const{__scopeSelect:t,children:l,...i}=o;return e.jsx(L.span,{"aria-hidden":!0,...i,ref:r,children:l||"▼"})});rt.displayName=co;var uo="SelectPortal",st=o=>e.jsx(Dt,{asChild:!0,...o});st.displayName=uo;var te="SelectContent",at=n.forwardRef((o,r)=>{const t=Y(te,o.__scopeSelect),[l,i]=n.useState();if(q(()=>{i(new DocumentFragment)},[]),!t.open){const p=l;return p?qe.createPortal(e.jsx(lt,{scope:o.__scopeSelect,children:e.jsx(ye.Slot,{scope:o.__scopeSelect,children:e.jsx("div",{children:o.children})})}),p):null}return e.jsx(it,{...o,ref:r})});at.displayName=te;var z=10,[lt,Q]=se(te),po="SelectContentImpl",fo=Bt("SelectContent.RemoveScroll"),it=n.forwardRef((o,r)=>{const{__scopeSelect:t,position:l="item-aligned",onCloseAutoFocus:i,onEscapeKeyDown:p,onPointerDownOutside:a,side:c,sideOffset:d,align:f,alignOffset:S,arrowPadding:C,collisionBoundary:P,collisionPadding:I,sticky:j,hideWhenDetached:u,avoidCollisions:y,..._}=o,h=Y(te,t),[w,U]=n.useState(null),[B,X]=n.useState(null),k=$(r,v=>U(v)),[s,m]=n.useState(null),[b,x]=n.useState(null),g=be(t),[A,O]=n.useState(!1),F=n.useRef(!1);n.useEffect(()=>{if(w)return At(w)},[w]),Ot();const M=n.useCallback(v=>{const[E,...V]=g().map(R=>R.ref.current),[N]=V.slice(-1),T=document.activeElement;for(const R of v)if(R===T||(R?.scrollIntoView({block:"nearest"}),R===E&&B&&(B.scrollTop=0),R===N&&B&&(B.scrollTop=B.scrollHeight),R?.focus(),document.activeElement!==T))return},[g,B]),K=n.useCallback(()=>M([s,w]),[M,s,w]);n.useEffect(()=>{A&&K()},[A,K]);const{onOpenChange:W,triggerPointerDownPosRef:G}=h;n.useEffect(()=>{if(w){let v={x:0,y:0};const E=N=>{v={x:Math.abs(Math.round(N.pageX)-(G.current?.x??0)),y:Math.abs(Math.round(N.pageY)-(G.current?.y??0))}},V=N=>{v.x<=10&&v.y<=10?N.preventDefault():w.contains(N.target)||W(!1),document.removeEventListener("pointermove",E),G.current=null};return G.current!==null&&(document.addEventListener("pointermove",E),document.addEventListener("pointerup",V,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",E),document.removeEventListener("pointerup",V,{capture:!0})}}},[w,W,G]),n.useEffect(()=>{const v=()=>W(!1);return window.addEventListener("blur",v),window.addEventListener("resize",v),()=>{window.removeEventListener("blur",v),window.removeEventListener("resize",v)}},[W]);const[we,de]=_t(v=>{const E=g().filter(T=>!T.disabled),V=E.find(T=>T.ref.current===document.activeElement),N=Ct(E,v,V);N&&setTimeout(()=>N.ref.current.focus())}),_e=n.useCallback((v,E,V)=>{const N=!F.current&&!V;(h.value!==void 0&&h.value===E||N)&&(m(v),N&&(F.current=!0))},[h.value]),Ce=n.useCallback(()=>w?.focus(),[w]),oe=n.useCallback((v,E,V)=>{const N=!F.current&&!V;(h.value!==void 0&&h.value===E||N)&&x(v)},[h.value]),ue=l==="popper"?Me:ct,ae=ue===Me?{side:c,sideOffset:d,align:f,alignOffset:S,arrowPadding:C,collisionBoundary:P,collisionPadding:I,sticky:j,hideWhenDetached:u,avoidCollisions:y}:{};return e.jsx(lt,{scope:t,content:w,viewport:B,onViewportChange:X,itemRefCallback:_e,selectedItem:s,onItemLeave:Ce,itemTextRefCallback:oe,focusSelectedItem:K,selectedItemText:b,position:l,isPositioned:A,searchRef:we,children:e.jsx(Lt,{as:fo,allowPinchZoom:!0,children:e.jsx(Vt,{asChild:!0,trapped:h.open,onMountAutoFocus:v=>{v.preventDefault()},onUnmountAutoFocus:D(i,v=>{h.trigger?.focus({preventScroll:!0}),v.preventDefault()}),children:e.jsx(Ht,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:p,onPointerDownOutside:a,onFocusOutside:v=>v.preventDefault(),onDismiss:()=>h.onOpenChange(!1),children:e.jsx(ue,{role:"listbox",id:h.contentId,"data-state":h.open?"open":"closed",dir:h.dir,onContextMenu:v=>v.preventDefault(),..._,...ae,onPlaced:()=>O(!0),ref:k,style:{display:"flex",flexDirection:"column",outline:"none",..._.style},onKeyDown:D(_.onKeyDown,v=>{const E=v.ctrlKey||v.altKey||v.metaKey;if(v.key==="Tab"&&v.preventDefault(),!E&&v.key.length===1&&de(v.key),["ArrowUp","ArrowDown","Home","End"].includes(v.key)){let N=g().filter(T=>!T.disabled).map(T=>T.ref.current);if(["ArrowUp","End"].includes(v.key)&&(N=N.slice().reverse()),["ArrowUp","ArrowDown"].includes(v.key)){const T=v.target,R=N.indexOf(T);N=N.slice(R+1)}setTimeout(()=>M(N)),v.preventDefault()}})})})})})})});it.displayName=po;var mo="SelectItemAlignedPosition",ct=n.forwardRef((o,r)=>{const{__scopeSelect:t,onPlaced:l,...i}=o,p=Y(te,t),a=Q(te,t),[c,d]=n.useState(null),[f,S]=n.useState(null),C=$(r,k=>S(k)),P=be(t),I=n.useRef(!1),j=n.useRef(!0),{viewport:u,selectedItem:y,selectedItemText:_,focusSelectedItem:h}=a,w=n.useCallback(()=>{if(p.trigger&&p.valueNode&&c&&f&&u&&y&&_){const k=p.trigger.getBoundingClientRect(),s=f.getBoundingClientRect(),m=p.valueNode.getBoundingClientRect(),b=_.getBoundingClientRect();if(p.dir!=="rtl"){const T=b.left-s.left,R=m.left-T,Z=k.left-R,J=k.width+Z,je=Math.max(J,s.width),Ne=window.innerWidth-z,Te=ze(R,[z,Math.max(z,Ne-je)]);c.style.minWidth=J+"px",c.style.left=Te+"px"}else{const T=s.right-b.right,R=window.innerWidth-m.right-T,Z=window.innerWidth-k.right-R,J=k.width+Z,je=Math.max(J,s.width),Ne=window.innerWidth-z,Te=ze(R,[z,Math.max(z,Ne-je)]);c.style.minWidth=J+"px",c.style.right=Te+"px"}const x=P(),g=window.innerHeight-z*2,A=u.scrollHeight,O=window.getComputedStyle(f),F=parseInt(O.borderTopWidth,10),M=parseInt(O.paddingTop,10),K=parseInt(O.borderBottomWidth,10),W=parseInt(O.paddingBottom,10),G=F+M+A+W+K,we=Math.min(y.offsetHeight*5,G),de=window.getComputedStyle(u),_e=parseInt(de.paddingTop,10),Ce=parseInt(de.paddingBottom,10),oe=k.top+k.height/2-z,ue=g-oe,ae=y.offsetHeight/2,v=y.offsetTop+ae,E=F+M+v,V=G-E;if(E<=oe){const T=x.length>0&&y===x[x.length-1].ref.current;c.style.bottom="0px";const R=f.clientHeight-u.offsetTop-u.offsetHeight,Z=Math.max(ue,ae+(T?Ce:0)+R+K),J=E+Z;c.style.height=J+"px"}else{const T=x.length>0&&y===x[0].ref.current;c.style.top="0px";const Z=Math.max(oe,F+u.offsetTop+(T?_e:0)+ae)+V;c.style.height=Z+"px",u.scrollTop=E-oe+u.offsetTop}c.style.margin=`${z}px 0`,c.style.minHeight=we+"px",c.style.maxHeight=g+"px",l?.(),requestAnimationFrame(()=>I.current=!0)}},[P,p.trigger,p.valueNode,c,f,u,y,_,p.dir,l]);q(()=>w(),[w]);const[U,B]=n.useState();q(()=>{f&&B(window.getComputedStyle(f).zIndex)},[f]);const X=n.useCallback(k=>{k&&j.current===!0&&(w(),h?.(),j.current=!1)},[w,h]);return e.jsx(xo,{scope:t,contentWrapper:c,shouldExpandOnScrollRef:I,onScrollButtonChange:X,children:e.jsx("div",{ref:d,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:U},children:e.jsx(L.div,{...i,ref:C,style:{boxSizing:"border-box",maxHeight:"100%",...i.style}})})})});ct.displayName=mo;var ho="SelectPopperPosition",Me=n.forwardRef((o,r)=>{const{__scopeSelect:t,align:l="start",collisionPadding:i=z,...p}=o,a=Se(t);return e.jsx(Ft,{...a,...p,ref:r,align:l,collisionPadding:i,style:{boxSizing:"border-box",...p.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Me.displayName=ho;var[xo,Be]=se(te,{}),De="SelectViewport",dt=n.forwardRef((o,r)=>{const{__scopeSelect:t,nonce:l,...i}=o,p=Q(De,t),a=Be(De,t),c=$(r,p.onViewportChange),d=n.useRef(0);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:l}),e.jsx(ye.Slot,{scope:t,children:e.jsx(L.div,{"data-radix-select-viewport":"",role:"presentation",...i,ref:c,style:{position:"relative",flex:1,overflow:"hidden auto",...i.style},onScroll:D(i.onScroll,f=>{const S=f.currentTarget,{contentWrapper:C,shouldExpandOnScrollRef:P}=a;if(P?.current&&C){const I=Math.abs(d.current-S.scrollTop);if(I>0){const j=window.innerHeight-z*2,u=parseFloat(C.style.minHeight),y=parseFloat(C.style.height),_=Math.max(u,y);if(_<j){const h=_+I,w=Math.min(j,h),U=h-w;C.style.height=w+"px",C.style.bottom==="0px"&&(S.scrollTop=U>0?U:0,C.style.justifyContent="flex-end")}}}d.current=S.scrollTop})})})]})});dt.displayName=De;var ut="SelectGroup",[go,vo]=se(ut),yo=n.forwardRef((o,r)=>{const{__scopeSelect:t,...l}=o,i=Le();return e.jsx(go,{scope:t,id:i,children:e.jsx(L.div,{role:"group","aria-labelledby":i,...l,ref:r})})});yo.displayName=ut;var pt="SelectLabel",bo=n.forwardRef((o,r)=>{const{__scopeSelect:t,...l}=o,i=vo(pt,t);return e.jsx(L.div,{id:i.id,...l,ref:r})});bo.displayName=pt;var ve="SelectItem",[So,ft]=se(ve),mt=n.forwardRef((o,r)=>{const{__scopeSelect:t,value:l,disabled:i=!1,textValue:p,...a}=o,c=Y(ve,t),d=Q(ve,t),f=c.value===l,[S,C]=n.useState(p??""),[P,I]=n.useState(!1),j=$(r,h=>d.itemRefCallback?.(h,l,i)),u=Le(),y=n.useRef("touch"),_=()=>{i||(c.onValueChange(l),c.onOpenChange(!1))};if(l==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return e.jsx(So,{scope:t,value:l,disabled:i,textId:u,isSelected:f,onItemTextChange:n.useCallback(h=>{C(w=>w||(h?.textContent??"").trim())},[]),children:e.jsx(ye.ItemSlot,{scope:t,value:l,disabled:i,textValue:S,children:e.jsx(L.div,{role:"option","aria-labelledby":u,"data-highlighted":P?"":void 0,"aria-selected":f&&P,"data-state":f?"checked":"unchecked","aria-disabled":i||void 0,"data-disabled":i?"":void 0,tabIndex:i?void 0:-1,...a,ref:j,onFocus:D(a.onFocus,()=>I(!0)),onBlur:D(a.onBlur,()=>I(!1)),onClick:D(a.onClick,()=>{y.current!=="mouse"&&_()}),onPointerUp:D(a.onPointerUp,()=>{y.current==="mouse"&&_()}),onPointerDown:D(a.onPointerDown,h=>{y.current=h.pointerType}),onPointerMove:D(a.onPointerMove,h=>{y.current=h.pointerType,i?d.onItemLeave?.():y.current==="mouse"&&h.currentTarget.focus({preventScroll:!0})}),onPointerLeave:D(a.onPointerLeave,h=>{h.currentTarget===document.activeElement&&d.onItemLeave?.()}),onKeyDown:D(a.onKeyDown,h=>{d.searchRef?.current!==""&&h.key===" "||(ro.includes(h.key)&&_(),h.key===" "&&h.preventDefault())})})})})});mt.displayName=ve;var ce="SelectItemText",ht=n.forwardRef((o,r)=>{const{__scopeSelect:t,className:l,style:i,...p}=o,a=Y(ce,t),c=Q(ce,t),d=ft(ce,t),f=io(ce,t),[S,C]=n.useState(null),P=$(r,_=>C(_),d.onItemTextChange,_=>c.itemTextRefCallback?.(_,d.value,d.disabled)),I=S?.textContent,j=n.useMemo(()=>e.jsx("option",{value:d.value,disabled:d.disabled,children:I},d.value),[d.disabled,d.value,I]),{onNativeOptionAdd:u,onNativeOptionRemove:y}=f;return q(()=>(u(j),()=>y(j)),[u,y,j]),e.jsxs(e.Fragment,{children:[e.jsx(L.span,{id:d.textId,...p,ref:P}),d.isSelected&&a.valueNode&&!a.valueNodeHasChildren?qe.createPortal(p.children,a.valueNode):null]})});ht.displayName=ce;var xt="SelectItemIndicator",gt=n.forwardRef((o,r)=>{const{__scopeSelect:t,...l}=o;return ft(xt,t).isSelected?e.jsx(L.span,{"aria-hidden":!0,...l,ref:r}):null});gt.displayName=xt;var ke="SelectScrollUpButton",vt=n.forwardRef((o,r)=>{const t=Q(ke,o.__scopeSelect),l=Be(ke,o.__scopeSelect),[i,p]=n.useState(!1),a=$(r,l.onScrollButtonChange);return q(()=>{if(t.viewport&&t.isPositioned){let c=function(){const f=d.scrollTop>0;p(f)};const d=t.viewport;return c(),d.addEventListener("scroll",c),()=>d.removeEventListener("scroll",c)}},[t.viewport,t.isPositioned]),i?e.jsx(bt,{...o,ref:a,onAutoScroll:()=>{const{viewport:c,selectedItem:d}=t;c&&d&&(c.scrollTop=c.scrollTop-d.offsetHeight)}}):null});vt.displayName=ke;var Ae="SelectScrollDownButton",yt=n.forwardRef((o,r)=>{const t=Q(Ae,o.__scopeSelect),l=Be(Ae,o.__scopeSelect),[i,p]=n.useState(!1),a=$(r,l.onScrollButtonChange);return q(()=>{if(t.viewport&&t.isPositioned){let c=function(){const f=d.scrollHeight-d.clientHeight,S=Math.ceil(d.scrollTop)<f;p(S)};const d=t.viewport;return c(),d.addEventListener("scroll",c),()=>d.removeEventListener("scroll",c)}},[t.viewport,t.isPositioned]),i?e.jsx(bt,{...o,ref:a,onAutoScroll:()=>{const{viewport:c,selectedItem:d}=t;c&&d&&(c.scrollTop=c.scrollTop+d.offsetHeight)}}):null});yt.displayName=Ae;var bt=n.forwardRef((o,r)=>{const{__scopeSelect:t,onAutoScroll:l,...i}=o,p=Q("SelectScrollButton",t),a=n.useRef(null),c=be(t),d=n.useCallback(()=>{a.current!==null&&(window.clearInterval(a.current),a.current=null)},[]);return n.useEffect(()=>()=>d(),[d]),q(()=>{c().find(S=>S.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[c]),e.jsx(L.div,{"aria-hidden":!0,...i,ref:r,style:{flexShrink:0,...i.style},onPointerDown:D(i.onPointerDown,()=>{a.current===null&&(a.current=window.setInterval(l,50))}),onPointerMove:D(i.onPointerMove,()=>{p.onItemLeave?.(),a.current===null&&(a.current=window.setInterval(l,50))}),onPointerLeave:D(i.onPointerLeave,()=>{d()})})}),wo="SelectSeparator",_o=n.forwardRef((o,r)=>{const{__scopeSelect:t,...l}=o;return e.jsx(L.div,{"aria-hidden":!0,...l,ref:r})});_o.displayName=wo;var Oe="SelectArrow",Co=n.forwardRef((o,r)=>{const{__scopeSelect:t,...l}=o,i=Se(t),p=Y(Oe,t),a=Q(Oe,t);return p.open&&a.position==="popper"?e.jsx(zt,{...i,...l,ref:r}):null});Co.displayName=Oe;var jo="SelectBubbleInput",St=n.forwardRef(({__scopeSelect:o,value:r,...t},l)=>{const i=n.useRef(null),p=$(l,i),a=Wt(r);return n.useEffect(()=>{const c=i.current;if(!c)return;const d=window.HTMLSelectElement.prototype,S=Object.getOwnPropertyDescriptor(d,"value").set;if(a!==r&&S){const C=new Event("change",{bubbles:!0});S.call(c,r),c.dispatchEvent(C)}},[a,r]),e.jsx(L.select,{...t,style:{...Ze,...t.style},ref:p,defaultValue:r})});St.displayName=jo;function wt(o){return o===""||o===void 0}function _t(o){const r=kt(o),t=n.useRef(""),l=n.useRef(0),i=n.useCallback(a=>{const c=t.current+a;r(c),(function d(f){t.current=f,window.clearTimeout(l.current),f!==""&&(l.current=window.setTimeout(()=>d(""),1e3))})(c)},[r]),p=n.useCallback(()=>{t.current="",window.clearTimeout(l.current)},[]);return n.useEffect(()=>()=>window.clearTimeout(l.current),[]),[t,i,p]}function Ct(o,r,t){const i=r.length>1&&Array.from(r).every(f=>f===r[0])?r[0]:r,p=t?o.indexOf(t):-1;let a=No(o,Math.max(p,0));i.length===1&&(a=a.filter(f=>f!==t));const d=a.find(f=>f.textValue.toLowerCase().startsWith(i.toLowerCase()));return d!==t?d:void 0}function No(o,r){return o.map((t,l)=>o[(r+l)%o.length])}var To=Je,Io=tt,Po=nt,Eo=rt,Ro=st,Mo=at,Do=dt,ko=mt,Ao=ht,Oo=gt,Lo=vt,Bo=yt;function Ue({...o}){return e.jsx(To,{"data-slot":"select",...o})}function Ke({...o}){return e.jsx(Po,{"data-slot":"select-value",...o})}function $e({className:o,size:r="default",children:t,...l}){return e.jsxs(Io,{"data-slot":"select-trigger","data-size":r,className:re("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",o),...l,children:[t,e.jsx(Eo,{asChild:!0,children:e.jsx(Xe,{className:"size-4 opacity-50"})})]})}function We({className:o,children:r,position:t="popper",...l}){return e.jsx(Ro,{children:e.jsxs(Mo,{"data-slot":"select-content",className:re("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",o),position:t,...l,children:[e.jsx(Vo,{}),e.jsx(Do,{className:re("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:r}),e.jsx(Ho,{})]})})}function Ge({className:o,children:r,...t}){return e.jsxs(ko,{"data-slot":"select-item",className:re("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 ps-2 pe-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",o),...t,children:[e.jsx("span",{className:"absolute end-2 flex size-3.5 items-center justify-center",children:e.jsx(Oo,{children:e.jsx(Ut,{className:"size-4"})})}),e.jsx(Ao,{children:r})]})}function Vo({className:o,...r}){return e.jsx(Lo,{"data-slot":"select-scroll-up-button",className:re("flex cursor-default items-center justify-center py-1",o),...r,children:e.jsx(eo,{className:"size-4"})})}function Ho({className:o,...r}){return e.jsx(Bo,{"data-slot":"select-scroll-down-button",className:re("flex cursor-default items-center justify-center py-1",o),...r,children:e.jsx(Xe,{className:"size-4"})})}const Re=[{value:"nezha",label:"哪吒面板"},{value:"dstatus",label:"DStatus"},{value:"komari",label:"Komari"}],Fo=[{value:"both",label:"上下行总和"},{value:"up",label:"仅上行"},{value:"down",label:"仅下行"}];function Qo(){const{auth:o}=Nt(),r=Tt(),[t,l]=n.useState({probeType:"nezha",address:"",servers:[]}),[i,p]=n.useState(!1),a=()=>typeof crypto<"u"&&crypto?.randomUUID?crypto.randomUUID():Math.random().toString(36).slice(2,10),{data:c,isLoading:d}=He({queryKey:["profile"],queryFn:Kt,enabled:!!o.accessToken,staleTime:300*1e3}),f=!!c?.is_admin,{data:S,isLoading:C}=He({queryKey:["probe-config"],queryFn:async()=>(await le.get("/api/admin/probe-config")).data,enabled:!!(o.accessToken&&f),staleTime:300*1e3});n.useEffect(()=>{const s=S?.config;if(!s)return;const m=(s.probe_type??"").toLowerCase().trim(),b=Re[0]?.value??"",x=Re.some(g=>g.value===m)?m:b;l({probeType:x,address:s.address?.trim()??"",servers:(s.servers??[]).map(g=>({key:`${g.id??g.server_id}-${g.position}`,id:g.id,server_id:g.server_id,name:g.name,traffic_method:g.traffic_method,monthly_traffic_gb:Number.isFinite(g.monthly_traffic_gb)?Number(g.monthly_traffic_gb):0}))})},[S]);const P=n.useMemo(()=>new Intl.DateTimeFormat("zh-CN",{dateStyle:"medium",timeStyle:"short",hour12:!1}),[]),I=n.useMemo(()=>{const s=S?.config?.updated_at;return s?P.format(new Date(s)):null},[S,P]),j=$t({mutationFn:async()=>{const s={probe_type:t.probeType,address:t.address.trim(),servers:t.servers.map(b=>({server_id:b.server_id.trim(),name:b.name.trim(),traffic_method:b.traffic_method,monthly_traffic_gb:(()=>{if(typeof b.monthly_traffic_gb=="number")return b.monthly_traffic_gb;if(typeof b.monthly_traffic_gb=="string"){const x=b.monthly_traffic_gb.trim();return x?Number(x):0}return 0})()}))};return(await le.put("/api/admin/probe-config",s)).data},onSuccess:s=>{H.success("探针配置已保存"),r.setQueryData(["probe-config"],{config:s.config}),r.invalidateQueries({queryKey:["traffic-summary"]})},onError:It}),u=(s,m,b)=>{l(x=>{const g=[...x.servers],A=b;let O=A;if(m==="monthly_traffic_gb")if(A===null)O=null;else if(typeof A=="string"){const M=A.trim();O=M===""?null:M}else O=A;const F={...g[s],[m]:O};return g.splice(s,1,F),{...x,servers:g}})},y=()=>{l(s=>({...s,servers:[...s.servers,{key:a(),server_id:"",name:"",traffic_method:"both",monthly_traffic_gb:null}]}))},_=s=>{l(m=>{const b=[...m.servers];return b.splice(s,1),{...m,servers:b}})},h=()=>t.address.trim().replace(/\/$/,""),w=async s=>((await le.post("/api/admin/probe-sync",{probe_type:"dstatus",address:s})).data?.servers??[]).map((x,g)=>({key:`${x.server_id||"server"}-${g}-${a()}`,server_id:x.server_id??"",name:x.name??`服务器 ${g+1}`,traffic_method:x.traffic_method??"both",monthly_traffic_gb:x.monthly_traffic_gb??0})),U=async s=>((await le.post("/api/admin/probe-sync",{probe_type:"nezha",address:s})).data?.servers??[]).map((x,g)=>({key:`${x.server_id||"server"}-${g}-${a()}`,server_id:x.server_id??"",name:x.name??`服务器 ${g+1}`,traffic_method:x.traffic_method??"both",monthly_traffic_gb:x.monthly_traffic_gb??null})),B=async s=>((await le.post("/api/admin/probe-sync",{probe_type:"komari",address:s})).data?.servers??[]).map((x,g)=>({key:`${x.server_id||"server"}-${g}-${a()}`,server_id:x.server_id??"",name:x.name??`服务器 ${g+1}`,traffic_method:x.traffic_method??"both",monthly_traffic_gb:x.monthly_traffic_gb??null})),X=async()=>{if(!t.address.trim()){H.error("请先填写探针面板地址");return}p(!0);try{const s=h();let m=[];if(t.probeType==="dstatus")m=await w(s);else if(t.probeType==="nezha")m=await U(s);else if(t.probeType==="komari")m=await B(s);else{H.error("当前探针类型暂不支持自动同步");return}if(m.length===0){H.error("未从面板获取到服务器列表");return}l(b=>({...b,servers:m})),H.success("已从面板同步服务器列表")}catch(s){console.error(s),H.error(s instanceof Error?s.message:"同步服务器失败，请检查面板地址或网络")}finally{p(!1)}},k=s=>{if(s.preventDefault(),!t.address.trim()){H.error("请输入探针地址");return}if(!t.probeType){H.error("请选择探针类型");return}if(t.servers.length===0){H.error("请至少添加一个服务器节点");return}for(const m of t.servers){if(!m.server_id.trim()){H.error("服务器 ID 不能为空");return}if(!m.name.trim()){H.error("服务器名称不能为空");return}if(!m.traffic_method){H.error("请选择流量计算方式");return}const b=(()=>{if(typeof m.monthly_traffic_gb=="number")return m.monthly_traffic_gb;if(typeof m.monthly_traffic_gb=="string"){const x=m.monthly_traffic_gb.trim();return x?Number(x):NaN}return NaN})();if(!Number.isFinite(b)||b<=0){H.error("请填写服务器月流量（GB）");return}}j.mutate()};return d||f&&C?e.jsxs("div",{className:"min-h-svh bg-background",children:[e.jsx(Ie,{}),e.jsx("main",{className:"mx-auto w-full max-w-5xl px-4 py-8 sm:px-6",children:e.jsxs(pe,{className:"border-dashed shadow-none",children:[e.jsxs(fe,{children:[e.jsx(me,{children:"加载中…"}),e.jsx(he,{children:"正在读取探针配置，请稍候。"})]}),e.jsx(Pe,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-10 w-full animate-pulse rounded-md bg-muted"}),e.jsx("div",{className:"h-10 w-full animate-pulse rounded-md bg-muted"}),e.jsx("div",{className:"h-10 w-full animate-pulse rounded-md bg-muted"})]})})]})})]}):f?e.jsxs("div",{className:"min-h-svh bg-background",children:[e.jsx(Ie,{}),e.jsx("main",{className:"mx-auto w-full max-w-5xl px-4 py-8 sm:px-6",children:e.jsxs("form",{className:"space-y-8",onSubmit:k,children:[e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-semibold tracking-tight",children:"探针数据源"}),e.jsx("p",{className:"text-muted-foreground",children:"配置 traffic 接口所使用的探针类型、面板地址以及参与汇总的服务器列表。"})]}),e.jsx(xe,{type:"submit",disabled:j.isPending,children:j.isPending?"保存中…":"保存配置"})]}),I?e.jsxs("p",{className:"text-sm text-muted-foreground",children:["最近保存：",I]}):null]}),e.jsxs(pe,{children:[e.jsxs(fe,{children:[e.jsx(me,{children:"探针信息"}),e.jsx(he,{children:"支持哪吒、DStatus、Komari 三种探针类型。"})]}),e.jsx(Pe,{className:"space-y-6",children:e.jsxs("div",{className:"grid gap-6 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"probe-type",children:"探针类型"}),e.jsxs(Ue,{value:t.probeType,onValueChange:s=>l(m=>({...m,probeType:s})),children:[e.jsx($e,{id:"probe-type",children:e.jsx(Ke,{placeholder:"选择探针类型"})}),e.jsx(We,{children:Re.map(s=>e.jsx(Ge,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"probe-address",children:"面板地址"}),e.jsx(ge,{id:"probe-address",value:t.address,onChange:s=>l(m=>({...m,address:s.target.value})),placeholder:"例如：https://panel.example.com"})]})]})})]}),e.jsxs(pe,{children:[e.jsxs(fe,{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(me,{children:"服务器列表"}),e.jsx(he,{children:"根据探针类型填写对应的服务器 ID、名称和流量统计方式。"}),e.jsx("p",{className:"mt-2 text-sm font-semibold text-destructive",children:"请为每个服务器填写月流量（GB），该字段为必填项。"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[["dstatus","nezha","komari"].includes(t.probeType)?e.jsx(xe,{type:"button",variant:"secondary",size:"sm",onClick:X,disabled:i,children:i?"同步中…":"从面板同步"}):null,e.jsxs(xe,{type:"button",variant:"outline",size:"sm",onClick:y,children:[e.jsx(Qt,{className:"mr-2 size-4"}),"新增服务器"]})]})]}),e.jsx(Pe,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Gt,{children:[e.jsx(qt,{children:e.jsxs(Ee,{children:[e.jsx(ie,{className:"w-[200px]",children:"服务器 ID"}),e.jsx(ie,{className:"w-[200px]",children:"显示名称"}),e.jsx(ie,{className:"w-[160px]",children:"流量统计"}),e.jsx(ie,{className:"w-[160px]",children:e.jsxs("span",{className:"flex items-center gap-1",children:["月流量 (GB)",e.jsx("span",{className:"text-destructive",children:"*"})]})}),e.jsx(ie,{className:"w-[80px]"})]})}),e.jsxs(Yt,{children:[t.servers.map((s,m)=>{const b=typeof s.monthly_traffic_gb=="number"?s.monthly_traffic_gb:typeof s.monthly_traffic_gb=="string"?Number(s.monthly_traffic_gb):NaN,x=!Number.isFinite(b)||b<=0;return e.jsxs(Ee,{children:[e.jsx(ne,{children:e.jsx(ge,{value:s.server_id,readOnly:!0,disabled:!0,placeholder:"服务器唯一 ID",className:"bg-muted/60 text-muted-foreground"})}),e.jsx(ne,{children:e.jsx(ge,{value:s.name,readOnly:!0,disabled:!0,placeholder:"用于展示的名称",className:"bg-muted/60 text-muted-foreground"})}),e.jsx(ne,{children:e.jsxs(Ue,{value:s.traffic_method,onValueChange:g=>u(m,"traffic_method",g),children:[e.jsx($e,{children:e.jsx(Ke,{})}),e.jsx(We,{children:Fo.map(g=>e.jsx(Ge,{value:g.value,children:g.label},g.value))})]})}),e.jsxs(ne,{children:[e.jsx(ge,{type:"number",inputMode:"decimal",min:0,step:"0.01",value:typeof s.monthly_traffic_gb=="number"?s.monthly_traffic_gb:s.monthly_traffic_gb??"",onChange:g=>u(m,"monthly_traffic_gb",g.target.value),className:x?"border-destructive focus-visible:ring-destructive/80 focus-visible:ring-2":void 0,"aria-invalid":x,placeholder:"必填，单位 GB",required:!0,title:"请填写服务器的月流量（GB）"}),x?e.jsx("p",{className:"mt-1 text-xs font-semibold text-destructive",children:"请输入该服务器的月流量（GB）"}):e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"单位：GB"})]}),e.jsx(ne,{className:"text-right",children:e.jsx(xe,{type:"button",variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>_(m),children:e.jsx(Xt,{className:"size-4"})})})]},s.key)}),t.servers.length===0?e.jsx(Ee,{children:e.jsx(ne,{colSpan:5,className:"py-10 text-center text-muted-foreground",children:"尚未配置服务器，请点击右上角按钮添加。"})}):null]})]})})})]})]})})]}):e.jsxs("div",{className:"min-h-svh bg-background",children:[e.jsx(Ie,{}),e.jsx("main",{className:"mx-auto flex w-full max-w-3xl flex-col items-center justify-center gap-4 px-4 py-20 text-center sm:px-6",children:e.jsx(pe,{className:"w-full border-dashed shadow-none",children:e.jsxs(fe,{children:[e.jsx(me,{children:"权限不足"}),e.jsx(he,{children:"仅管理员可管理探针数据源配置。"})]})})})]})}export{Qo as component};
